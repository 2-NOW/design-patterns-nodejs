<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 3.7.2"/><script>/**
──────────────███████──███████
──────────████▓▓▓▓▓▓████░░░░░██
────────██▓▓▓▓▓▓▓▓▓▓▓▓██░░░░░░██
──────██▓▓▓▓▓▓████████████░░░░██
────██▓▓▓▓▓▓████████████████░██
────██▓▓████░░░░░░░░░░░░██████              MAMMA MIA!
──████████░░░░░░██░░██░░██▓▓▓▓██
──██░░████░░░░░░██░░██░░██▓▓▓▓██   If you are looking here you
██░░░░██████░░░░░░░░░░░░░░██▓▓██      should definitely get
██░░░░░░██░░░░██░░░░░░░░░░██▓▓██       in touch with me on
──██░░░░░░░░░███████░░░░██████           twitter: @loige
────████░░░░░░░███████████▓▓██
──────██████░░░░░░░░░░██▓▓▓▓██
────██▓▓▓▓██████████████▓▓██
──██▓▓▓▓▓▓▓▓████░░░░░░████
████▓▓▓▓▓▓▓▓██░░░░░░░░░░██
████▓▓▓▓▓▓▓▓██░░░░░░░░░░██
██████▓▓▓▓▓▓▓▓██░░░░░░████████
──██████▓▓▓▓▓▓████████████████
────██████████████████████▓▓▓▓██
──██▓▓▓▓████████████████▓▓▓▓▓▓██
████▓▓██████████████████▓▓▓▓▓▓██
██▓▓▓▓██████████████████▓▓▓▓▓▓██
██▓▓▓▓██████████──────██▓▓▓▓████
██▓▓▓▓████──────────────██████
──████
**/</script><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="alternate" type="application/rss+xml" title="Luciano Mammino &quot;Loige&quot; - FullStack &amp; Cloud developer, fighter, butterfly maker!" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=e5514a6b277bf3f1409d8b0190e93509" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#20232a"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=e5514a6b277bf3f1409d8b0190e93509"/><title data-react-helmet="true">How to send gzipped requests with boto3</title><link data-react-helmet="true" type="text/plain" rel="author" href="https://loige.co/humans.txt"/><link data-react-helmet="true" rel="canonical" content="https://loige.co/how-to-send-gzipped-requests-with-boto3/"/><meta data-react-helmet="true" name="description" content="I recently needed to send a big payload to CloudWatch and I managed to increase my chances of staying within the AWS payload size limit by…"/><meta data-react-helmet="true" name="image" content="https://loige.co/static/4ee16a0214bacf5a20f503010e492555/how-to-send-gzipped-requests-with-boto3-fb.png"/><meta data-react-helmet="true" property="og:url" content="https://loige.co/how-to-send-gzipped-requests-with-boto3/"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="How to send gzipped requests with boto3"/><meta data-react-helmet="true" property="og:description" content="I recently needed to send a big payload to CloudWatch and I managed to increase my chances of staying within the AWS payload size limit by…"/><meta data-react-helmet="true" property="og:image" content="https://loige.co/static/4ee16a0214bacf5a20f503010e492555/how-to-send-gzipped-requests-with-boto3-fb.png"/><meta data-react-helmet="true" property="fb:app_id" content="231187154413670"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="loige"/><meta data-react-helmet="true" name="twitter:title" content="How to send gzipped requests with boto3"/><meta data-react-helmet="true" name="twitter:description" content="I recently needed to send a big payload to CloudWatch and I managed to increase my chances of staying within the AWS payload size limit by…"/><meta data-react-helmet="true" name="twitter:image" content="https://loige.co/static/48828f50736a2ff01718d5cf9b8a61c2/how-to-send-gzipped-requests-with-boto3-tw.png"/><script data-react-helmet="true" type="application/ld+json">[{"@context":"http://schema.org","@type":"WebSite","url":"https://loige.co/how-to-send-gzipped-requests-with-boto3/","name":"How to send gzipped requests with boto3","alternateName":"Luciano Mammino \"Loige\" - FullStack & Cloud developer, fighter, butterfly maker!"},{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://loige.co/how-to-send-gzipped-requests-with-boto3/","name":"How to send gzipped requests with boto3","image":"https://loige.co/static/4ee16a0214bacf5a20f503010e492555/how-to-send-gzipped-requests-with-boto3-fb.png"}}]},{"@context":"http://schema.org","@type":"BlogPosting","url":"https://loige.co/how-to-send-gzipped-requests-with-boto3/","name":"How to send gzipped requests with boto3","alternateName":"Luciano Mammino \"Loige\" - FullStack & Cloud developer, fighter, butterfly maker!","headline":"How to send gzipped requests with boto3","image":{"@type":"ImageObject","url":"https://loige.co/static/4ee16a0214bacf5a20f503010e492555/how-to-send-gzipped-requests-with-boto3-fb.png"},"description":"I recently needed to send a big payload to CloudWatch and I managed to increase my chances of staying within the AWS payload size limit by…","author":{"@type":"Person","name":"Luciano Mammino"},"publisher":{"@type":"Organization","url":"https://loige.co/","name":"Luciano Mammino","logo":{"@context":"http://schema.org","itemtype":"https://schema.org/ImageObject","url":"https://loige.co/favicon.ico"}},"mainEntityOfPage":{"@type":"WebSite","@id":"https://loige.co/"},"datePublished":"2021-06-22T18:20:00.000Z"}]</script><link as="script" rel="preload" href="/webpack-runtime-0019acd3e3ba19e6ba77.js"/><link as="script" rel="preload" href="/framework-9d9eff57288a5d76d992.js"/><link as="script" rel="preload" href="/app-514e309b4e51a67a0ada.js"/><link as="script" rel="preload" href="/ab670281d767243777119348a2b810446e7309bb-19b089964506eaf24367.js"/><link as="script" rel="preload" href="/850935577dc6138b95e5bc3f6f1d9b06bd36398e-bd6be05cfb6becde2e63.js"/><link as="script" rel="preload" href="/4d6423837748823c19bdd3076c1db680baba727b-30a9131768be883bb7a1.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-f8a40d902eea460a8b7d.js"/><link as="fetch" rel="preload" href="/page-data/how-to-send-gzipped-requests-with-boto3/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><style data-emotion="css-global xqze0f">*{box-sizing:border-box;margin:0;padding:0;}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-style:normal;font-weight:400;fill:currentColor;}@media (min-width: 780px){body{margin:60px 0 0 0;}}code,pre{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace;font-weight:300;}.content a{-webkit-text-decoration:none;text-decoration:none;}blockquote .gatsby-highlight{margin:1.5em 0 1.5em 0;padding:0.5em;}.gatsby-highlight{font-size:15px;line-height:1.7;background:#282c34;color:#ffffff;border-radius:10px;overflow:auto;tab-size:1.5em;margin:1.5em -1em 1.5em 0;padding:1em;}@media (min-width: 780px){.gatsby-highlight{margin-left:-2em;padding-left:2em;padding-right:2em;font-size:16px;}}.gatsby-highlight .token.attr-name{color:#c5a5c5;}.gatsby-highlight .token.comment,.gatsby-highlight .token.block-comment,.gatsby-highlight .token.prolog,.gatsby-highlight .token.doctype,.gatsby-highlight .token.cdata{color:#999999;}.gatsby-highlight .token.property,.gatsby-highlight .token.number,.gatsby-highlight .token.function-name,.gatsby-highlight .token.constant,.gatsby-highlight .token.symbol,.gatsby-highlight .token.deleted{color:#5a9bcf;}.gatsby-highlight .token.boolean{color:#ff8b50;}.gatsby-highlight .token.tag{color:#fc929e;}.gatsby-highlight .token.string{color:#8dc891;}.gatsby-highlight .token.punctuation{color:#5FB3B3;}.gatsby-highlight .token.selector,.gatsby-highlight .token.char,.gatsby-highlight .token.builtin,.gatsby-highlight .token.inserted{color:#D8DEE9;}.gatsby-highlight .token.function{color:#79b6f2;}.gatsby-highlight .token.operator,.gatsby-highlight .token.entity,.gatsby-highlight .token.url,.gatsby-highlight .token.variable{color:#d7deea;}.gatsby-highlight .token.attr-value{color:#8dc891;}.gatsby-highlight .token.keyword{color:#c5a5c5;}.gatsby-highlight .token.atrule,.gatsby-highlight .token.class-name{color:#FAC863;}.gatsby-highlight .token.important{font-weight:400;}.gatsby-highlight .token.bold{font-weight:700;}.gatsby-highlight .token.italic{font-style:italic;}.gatsby-highlight .token.entity{cursor:help;}.gatsby-highlight>pre{height:auto!important;margin:1rem;white-space:pre-wrap;word-break:break-word;}.gatsby-highlight+.gatsby-highlight{margin-top:20px,;}.gatsby-highlight-code-line{background-color:#14161a;display:block;margin:-0.125rem calc(-1rem - 15px);padding:0.125rem calc(1rem + 15px);}</style><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css 1l9yz54 1q6mh99 m735s1 1q6mh99 m735s1 1q6mh99 m735s1 1q6mh99 m735s1 1q6mh99 m735s1">.css-1l9yz54{display:none;}@media (min-width: 540px){.css-1l9yz54{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-1q6mh99{color:#fff;-webkit-text-decoration:none;text-decoration:none;text-align:center;padding:5px 4px;white-space:nowrap;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:background 150ms;transition:background 150ms;border-radius:0.5em;}.css-1q6mh99:hover{background:rgba(255, 255, 255, 0.2);}@media (min-width: 780px){.css-1q6mh99{padding:5px 10px;}}.css-m735s1{width:16px;height:16px;color:#fff;fill:currentColor;}@media (min-width: 540px){.css-m735s1{width:24px;height:24px;}}@media (min-width: 1180px){.css-m735s1{margin:0 0 0 0;}}</style><style data-emotion="css z5ptlm">.css-z5ptlm{background-color:rgba(32, 35, 42, 0.95);color:#ffffff;display:block;position:auto;z-index:2000;width:100%;top:0;left:0;}@media (min-width: 780px){.css-z5ptlm{position:fixed;}}</style><header class="css-z5ptlm ejhzk945"><style data-emotion="css otpe3t">.css-otpe3t{padding-left:4px;padding-right:4px;margin-left:auto;margin-right:auto;max-width:1260px;}@media (min-width: 780px){.css-otpe3t{width:90%;padding-left:20px;padding-right:20px;}}</style><div class="css-otpe3t ejhzk944"><style data-emotion="css z95nvu">.css-z95nvu{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:60px;}</style><div class="css-z95nvu ejhzk943"><style data-emotion="css s0y9ho x9illq 192ssef">.css-s0y9ho{color:#46c9e5;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-right:10px;height:100%;-webkit-text-decoration:none;text-decoration:none;-webkit-flex-direction:center;-ms-flex-direction:center;flex-direction:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:none;}@media (min-width: 600px){.css-s0y9ho{width:calc(100% / 6);}}@media (min-width: 540px){.css-s0y9ho{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-x9illq{display:inline-block;vertical-align:top;}.css-192ssef{margin-left:10px;font-weight:bold;font-size:20px;line-height:20px;}</style><a class="css-s0y9ho" href="/"><img class="css-x9illq" height="60px" src="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjExNjMuMTI2IiB2aWV3Qm94PSIwIDAgMTI4NS41NjMgMTE2My4xMjYiIHdpZHRoPSIxMjg1LjU2MyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGNsaXBQYXRoIGlkPSJhIj48cGF0aCBkPSJtMCAwaDEyODUuNTYzdjExNjMuMTI2aC0xMjg1LjU2M3oiLz48L2NsaXBQYXRoPjxnIGNsaXAtcGF0aD0idXJsKCNhKSI+PHBhdGggZD0ibTExNjMuMTMxIDU1MC45NTV2NjEuMjE2aC02MS4yMTd2MjQ0Ljg2OWg2MS4yMTcgNjEuMjE2di0zMDYuMDg1eiIgZmlsbD0iIzc0NGUyNiIvPjxwYXRoIGQ9Im01NTAuOTU1IDc5NS44MjRoLTEyMi40Mzd2NjEuMjE2aC02MS4yMTZ2MTIyLjQzN2gxMjIuNDM3di02MS4yMTZoNjEuMjE2eiIgZmlsbD0iIzc0NGUyNiIvPjxwYXRoIGQ9Im05MTguMjYxIDYxMi4xNzFoLTYxLjIxNnYtNjEuMjE2aDYxLjIxNnptNjEuMjE3IDBoLTYxLjIxN3Y2MS4yMTZoNjEuMjE3em0xMjIuNDMyIDYxLjIxNnYxODMuNjUzaC0xMjIuNDMyLTEyMi40Mzd2NjEuMjE3aC0xMjIuNDMzLTE4My42NTN2LTE4My42NDloMTIyLjQzN3YtMTIyLjQzN2g2MS4yMTZ2NjEuMjE2aDE4My42NTN2NjEuMjIxaDYxLjIxN3YtNjEuMjIxem0tMzA2LjA4NiA2MS4yMjFoLTYxLjIxNnY2MS4yMTZoNjEuMjE2em0tMTgzLjY0OC0xMjIuNDM3aDYxLjIxNnYtNjEuMjE2aC02MS4yMTZ6IiBmaWxsPSIjNGVjMmM4Ii8+PHBhdGggZD0ibTkxOC4yNjEgMTIyLjQzMnYtNjEuMjE2aC00MjguNTE4djYxLjIxNmgtNjEuMjIxdjM2Ny4zMDJoMTIyLjQzN3YtNjEuMjE2aC02MS4yMTZ2LTEyMi40MzNoNjEuMjE2djEyMi40MzNoNjEuMjE3di0xMjIuNDMzaDEyMi40MzJ2LTEyMi40MzZoMTgzLjY1M3Y2MS4yMmg2MS4yMTd2LTEyMi40Mzd6IiBmaWxsPSIjNzQ0ZTI2Ii8+PHBhdGggZD0ibTk3OS40NzggMTIyLjQzNmg2MS4yMTZ2NjEuMjE3aC02MS4yMTZ6IiBmaWxsPSIjMmEyYTJhIi8+PHBhdGggZD0ibTYxMi4xNzEgNjEyLjE3MWg2MS4yMTd2MTIyLjQzN2gtMTgzLjY0OXYtNjEuMjE3aC0xMjIuNDM3di0xMjIuNDM2aDI0NC44Njl6bTM2Ny4zMDcgNjEuMjJoLTYxLjIxN3Y2MS4yMTdoNjEuMjE3em0tMjQ0Ljg3NCAxMjIuNDMzaDYxLjIxNnYtNjEuMjE2aC02MS4yMTZ6bTI0NC44NzQtNjEyLjE3MXY2MS4yMTZoNjEuMjE2djEyMi40MzNoLTYxLjIxNnYxODMuNjUzaC02MS4yMjF2NjEuMjE2aDEyMi40Mzd2LTYxLjIxNmg2MS4yMTZ2LTYxLjIxN2g2MS4yMTZ2LTYxLjIyLTEyMi40MzMtMTIyLjQzMnptLTEyMi40MzcgMzY3LjMwMmgtMTgzLjY1M3Y2MS4yMTZoNjEuMjE2djYxLjIyaDE4My42NTN2LTYxLjIyaC02MS4yMTZ6IiBmaWxsPSIjZmJkODAwIi8+PHBhdGggZD0ibTEyMjQuMzQ3IDQ4OS43MzR2LTQ4OS43MzRoLTYxLjIxNi03MzQuNjA5djYxLjIxNmgtNjEuMjE2djQyOC41MThoLTE4My42NTN2NjEuMjIxaC02MS4yMnYxODMuNjQ5aDI0NC44NzN2NjEuMjJoLTEyMi40Mzd2NjEuMjE2aC02MS4yMTZ2NjEuMjE3aDYxLjIxNnY2MS4yMmg2MS4yMTd2NjEuMjE2aDEyMi40MzZ2NjEuMjE3aDYxLjIxN3YtNjEuMjE3aDYxLjIxNnYtNjEuMjE2aDQyOC41MjN2LTYxLjIyaDMwNi4wODV2LTQyOC41MjN6bTAgMzY3LjMwNmgtMzY3LjMwNnY2MS4yMTdoLTM2Ny4zMDJ2NjEuMjJoLTEyMi40MzN2LTEyMi40MzdoNjEuMjE2di02MS4yMTZoMTIyLjQzM3YtNjEuMjJoLTYxLjIxNnYtNjEuMjE3aC0zMDYuMDg2di02MS4yMTZoNjEuMjE2di02MS4yMTZoMTIyLjQzNyAxODMuNjQ5di02MS4yMjFoLTEyMi40MzN2LTE4My42NDktMTgzLjY1M2g2MS4yMTd2LTYxLjIxNmg0MjguNTIydjYxLjIxNmg2MS4yMTd2LTYxLjIxNmgxODMuNjUzdjQyOC41MThoLTYxLjIyMXY2MS4yMjFoLTYxLjIxNnY2MS4yMTZoLTYxLjIxNnY2MS4yMTZoMTIyLjQzMnYtNjEuMjE2aDYxLjIyMXYtNjEuMjE2aDYxLjIxNnoiIGZpbGw9IiMyYTJhMmEiLz48cGF0aCBkPSJtODU3LjA0MSAzMDYuMDg1aC02MS4yMTd2LTYxLjIxNmg2MS4yMTd6bS02NzMuMzg4IDYxMi4xNzJoLTYxLjIxNnY2MS4yMTZoNjEuMjE2em0xODMuNjUzIDI0NC44NjloNjEuMjE2di02MS4yMTZoLTYxLjIxNnptLTE4My42NTMtNjEuMjE2aDYxLjIxNnYtNjEuMjE3aC02MS4yMTZ6bS0xODMuNjUzIDBoNjEuMjE2di02MS4yMTdoLTYxLjIxNnptOTc5LjQ3OC02NzMuMzkydi02MS4yMTZoLTE4My42NTR2NjEuMjE2aC02MS4yMTZ2MTIyLjQzN2gxMjIuNDMzIDEyMi40Mzd2LTYxLjIyMWgtMTIyLjQzN3YtNjEuMjE2eiIgZmlsbD0iIzJhMmEyYSIvPjxnIGZpbGw9IiNmZmYiPjxwYXRoIGQ9Im03OTUuODI0IDI0NC44NjloMTIyLjQzNnYtNjEuMjE2aC0xMjIuNDM2LTYxLjIxNnYxMjIuNDMyaDYxLjIxNnptNjEuMjE3IDYxLjIxNmgtNjEuMjE3djYxLjIxN2gyNDQuODcydi02MS4yMTdoLS4wMDJ2LTYxLjIxNmgtMTgzLjY1M3ptLTMwNi4wODYgMTIyLjQzM2gxODMuNjUzdjEyMi40MzdoLTE4My42NTN6bS02MS4yMTYtMTIyLjQzM2g2MS4yMTZ2MTIyLjQzM2gtNjEuMjE2em0xMjIuNDM3IDBoMTgzLjY0OHYxMjIuNDMzaC0xODMuNjQ4em0yNDQuODY1IDEyMi40MzNoMTIyLjQzN3Y2MS4yMTZoLTEyMi40Mzd6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48cGF0aCBkPSJtMjQ0Ljg2OSA2NzMuMzkxaDEyMi40MzN2LTEyMi40MzZoLTEyMi40MzN2NjEuMjE4aC02MS4yMTZ2NjEuMjE4eiIvPjxwYXRoIGQ9Im0xMTYzLjEyNiAxMjIuNDM2aC4wMDV2LTYxLjIyaC0xODMuNjUzdjYxLjIyaDYxLjIxOHY2MS4yMTdoMTIyLjQzeiIvPjwvZz48L2c+PC9zdmc+" alt="Loige"/><span class="css-192ssef">Loige</span></a><style data-emotion="css 1ld37qd">.css-1ld37qd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;height:100%;width:60%;}@media (min-width: 1180px){.css-1ld37qd{width:60%;}}</style><nav class="css-1ld37qd ejhzk942"><style data-emotion="css brnyfx 1f3jrqb">.css-brnyfx{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#ffffff;-webkit-transition:color 0.2s ease-out;transition:color 0.2s ease-out;padding-left:15px;padding-right:15px;font-weight:300;-webkit-text-decoration:none;text-decoration:none;}@media (min-width: 1280px){.css-brnyfx{padding-left:20px;padding-right:20px;font-size:18px;}}.css-1f3jrqb{color:#46c9e5;position:relative;}</style><a class="css-brnyfx css-1f3jrqb" href="/"><style data-emotion="css 1eand3o">.css-1eand3o{position:absolute;bottom:-1px;height:4px;left:0px;right:0px;z-index:1;background:#46c9e5;}</style><span class="css-1eand3o e5yudoc0"></span>Blog</a><a class="css-brnyfx" href="/speaking">Speaking</a><a class="css-brnyfx" href="/about">About</a></nav><style data-emotion="css 150b3u1">.css-150b3u1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;height:100%;width:40%;}@media (min-width: 1180px){{width:40%;}}</style><div class="css-150b3u1 ejhzk941"><a rel="nofollow" class="css-1q6mh99" href="https://twitter.com/loige"><svg aria-label="Twitter" viewBox="0 0 24 24" width="1em" height="1em" class="css-m735s1" alt="Luciano&#x27;s Twitter profile"><path fill="currentColor" d="M23.954 4.569a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.691 8.094 4.066 6.13 1.64 3.161a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.061a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.937 4.937 0 0 0 4.604 3.417 9.868 9.868 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63a9.936 9.936 0 0 0 2.46-2.548l-.047-.02z"></path></svg></a><a rel="nofollow" class="css-1q6mh99" href="https://twitch.tv/loige"><svg aria-label="Twitch" viewBox="0 0 24 24" width="1em" height="1em" class="css-m735s1" alt="Luciano&#x27;s Twitch profile"><path fill="currentColor" d="M.975 4.175v16.694h5.749V24h3.139l3.134-3.132h4.705l6.274-6.258V0H2.542zm3.658-2.09h17.252v11.479l-3.66 3.652h-5.751L9.34 20.343v-3.127H4.633z"></path><path fill="currentColor" d="M10.385 6.262h2.09v6.26h-2.09zM16.133 6.262h2.091v6.26h-2.091z"></path></svg></a><a rel="nofollow" class="css-1q6mh99" href="https://www.youtube.com/channel/UCL0w2IAjTBx3NNka-l7InPw"><svg aria-label="Youtube" viewBox="0 0 24 24" width="1em" height="1em" class="css-m735s1" alt="Luciano&#x27;s YouTube profile"><path fill="currentColor" d="M23.469 5.929l.03.196a3.043 3.043 0 0 0-2.068-2.112l-.021-.005c-1.871-.508-9.4-.508-9.4-.508s-7.51-.01-9.4.508A3.044 3.044 0 0 0 .527 6.104l-.005.021c-.699 3.651-.704 8.038.031 11.947l-.031-.198a3.043 3.043 0 0 0 2.068 2.112l.021.005c1.869.509 9.4.509 9.4.509s7.509 0 9.4-.509a3.043 3.043 0 0 0 2.084-2.096l.005-.021c.318-1.698.5-3.652.5-5.648l-.001-.221.001-.23c0-1.997-.182-3.951-.531-5.846zM9.608 15.651V8.358l6.266 3.652z"></path></svg></a><a rel="nofollow" class="css-1q6mh99" href="https://www.linkedin.com/in/lucianomammino/"><svg aria-label="LinkedIn" viewBox="0 0 24 24" width="1em" height="1em" class="css-m735s1" alt="Luciano&#x27;s LinkedIn profile"><path fill="currentColor" d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a rel="nofollow" class="css-1q6mh99" href="https://github.com/lmammino"><svg aria-label="GitHub" viewBox="0 0 24 24" width="1em" height="1em" class="css-m735s1" alt="Luciano&#x27;s GitHub profile"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div></div></div><style data-emotion="css 1cfofik">.css-1cfofik{height:2px;display:block;transform-origin:left center 0px;-webkit-transform:scaleX(1);-moz-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);z-index:50;-webkit-transition:-webkit-transform 400ms ease 100ms;transition:transform 400ms ease 100ms;background:linear-gradient(90deg, #46c9e5, #d26ac2);}</style><span class="css-1cfofik ejhzk940"></span></header><style data-emotion="css gvup9u">.css-gvup9u{background-color:#46c9e5;background-repeat:no-repeat;-webkit-background-position:center;background-position:center;-webkit-background-size:cover;background-size:cover;width:100%;min-height:300px;height:50vh;display:table;}.css-gvup9u.small{max-height:300px;}.css-gvup9u.tiledBg{-webkit-background-size:auto;background-size:auto;background-repeat:repeat;}.css-gvup9u.bottomRightBg{-webkit-background-position:bottom right;background-position:bottom right;}.css-gvup9u.gradientOverlay{position:relative;z-index:-2;}.css-gvup9u.gradientOverlay:before{content:'';position:absolute;top:0;right:0;bottom:0;left:0;background-image:linear-gradient(to bottom right, #46c9e5, #d26ac2);opacity:0.6;z-index:-1;}@media (min-width: 780px){.css-gvup9u{height:70vh;}}</style><div class="textOverlay css-gvup9u ea1ziiz1" style="background-image:url(/static/8b41b98bf31055ba99f44b3531680e24/how-to-send-gzipped-requests-with-boto3-luciano-mammino-loige.jpg)"><style data-emotion="css 1vmuur7">.css-1vmuur7{display:table-cell;vertical-align:middle;text-align:center;font-weight:700;color:#fff;padding:0 2em;color:white;text-shadow:1px 3px 0 #000,-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;}@media (min-width: 780px){.css-1vmuur7{font-size:1.2em;}}.css-1vmuur7 h1{font-size:2em;line-height:1.6em;}.css-1vmuur7 h2{font-size:1.5em;margin:0.5em 0 0 0;line-height:1.6em;}.css-1vmuur7.textOverlay>*>span{background:#000000c4;display:inline;padding:0.2em;-webkit-box-decoration-break:clone;box-decoration-break:clone;-webkit-box-decoration-break:clone;}</style><div class="textOverlay css-1vmuur7 ea1ziiz0"><h1><span>How to send gzipped requests with boto3</span></h1></div></div><style data-emotion="css 48rqd6">.css-48rqd6{min-height:100vh;margin:0 auto;padding-left:20px;padding-right:20px;max-width:1260px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media (min-width: 780px){.css-48rqd6{width:90%;}}</style><div class="css-48rqd6 e1kc7zwr4"><style data-emotion="css y3klfd">.css-y3klfd{-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><section class="css-y3klfd e1kc7zwr3"><style data-emotion="css 3igp7s">.css-3igp7s{-webkit-flex:1;-ms-flex:1;flex:1;}@media (min-width: 780px){.css-3igp7s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}</style><div class="css-3igp7s e1kc7zwr2"><style data-emotion="css nmfn">.css-nmfn{-webkit-flex:3;-ms-flex:3;flex:3;width:100%;}</style><main class="css-nmfn e1kc7zwr1"><style data-emotion="css t2ycg8">.css-t2ycg8{margin:2em 0;line-height:25px;padding:0 1em;}.css-t2ycg8 a{-webkit-text-decoration:none;text-decoration:none;color:inherit;}.css-t2ycg8 a:hover{-webkit-text-decoration:underline;text-decoration:underline;}@media (min-width: 780px){.css-t2ycg8{padding:0 2em;}}</style><div class="css-t2ycg8 ep8980s1"><style data-emotion="css 0 rm23k1">.css-rm23k1{margin:0 0.25em 0 0;}</style><style data-emotion="css 1o5dns8">.css-1o5dns8{vertical-align:middle;font-size:inherit;margin:0 0.5em;display:inline-block;}.css-1o5dns8 span{vertical-align:text-bottom;}</style><span style="margin-left:0" class="css-1o5dns8 e1r90wi10"><svg aria-hidden="true" data-prefix="far" data-icon="calendar-alt" class="css-rm23k1" viewBox="0 0 448 512" width="1em" height="1em"><path fill="currentColor" d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"></path></svg><span>June 22, 2021</span></span><style data-emotion="css j1wil6">.css-j1wil6{vertical-align:middle;margin:0 0.5em 0 1em;display:inline-block;}.css-j1wil6 a{color:inherit;font-weight:bold;-webkit-text-decoration:none;text-decoration:none;vertical-align:text-bottom;}</style><span class="css-j1wil6 ex82wp61"><svg aria-hidden="true" data-prefix="fas" data-icon="tags" class="css-rm23k1" viewBox="0 0 640 512" width="1em" height="1em"><path fill="currentColor" d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"></path></svg><a href="/tag/python">#<!-- -->python</a><style data-emotion="css 15kp1k9">.css-15kp1k9{vertical-align:text-bottom;}</style><span class="css-15kp1k9 ex82wp60">, </span><a href="/tag/aws">#<!-- -->aws</a></span><a href="#comments" title="Read comments"><svg aria-hidden="true" data-prefix="fas" data-icon="comments" class="svg-inline--fa fa-comments fa-w-18" viewBox="0 0 576 512" width="1em" height="1em" style="margin:0 .25em 0 1em"><path fill="currentColor" d="M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"></path></svg><span class="disqus-comment-count" data-disqus-identifier="how-to-send-gzipped-requests-with-boto3" data-disqus-url="https://loige.co/how-to-send-gzipped-requests-with-boto3">comments</span></a><p>— Published by<!-- --> <style data-emotion="css 1u9uk5p">.css-1u9uk5p{background:transparent!important;white-space:nowrap!important;color:#000!important;}.css-1u9uk5p:hover{-webkit-text-decoration:underline!important;text-decoration:underline!important;}</style><a href="https://twitter.com/loige" rel="nofollow noopener noreferrer" target="_blank" class="css-1u9uk5p e1ondplw2"><style data-emotion="css 1gejjbo">.css-1gejjbo{border-radius:50%;width:2em;height:2em;vertical-align:middle;display:inline-block;margin:0 .5em 0 0;overflow:hidden;}</style><img alt="Luciano Mammino&#x27;s profile picture" src="https://unavatar.now.sh/github/lmammino" class="css-1gejjbo e1ondplw1"/>Luciano Mammino</a></p></div><style data-emotion="css 1eveted">.css-1eveted{margin:2em 0;line-height:25px;padding:0 1em;}.css-1eveted code{white-space:pre-wrap;word-break:break-word;}@media (min-width: 780px){.css-1eveted{padding:0 2em;}}.css-1eveted a{background-color:rgba(187, 239, 253, 0.3);border-bottom:1px solid rgba(0, 0, 0, 0.2);-webkit-text-decoration:none;text-decoration:none;color:inherit;}.css-1eveted a:hover{background-color:#bbeffd;border-bottom-color:#1a1a1a;}.css-1eveted a.anchor,.css-1eveted a.gatsby-resp-image-link{background-color:transparent;border:none;}.css-1eveted a.anchor.before{position:absolute;top:64px;left:-1em;}.css-1eveted>p:first-of-type{font-size:18px;font-weight:300;color:#6d6d6d;}.css-1eveted>p:first-of-type a,.css-1eveted>p:first-of-type strong{font-weight:400;}@media (min-width: 780px){.css-1eveted>p:first-of-type{font-size:24px;}}.css-1eveted p{margin:1em 0 0 0;font-size:16px;line-height:1.7;max-width:42em;}@media (min-width: 780px){.css-1eveted p{font-size:17px;line-height:1.7;}}.css-1eveted h2,.css-1eveted h3,.css-1eveted h4,.css-1eveted h5{margin:2em 0 0 0;}.css-1eveted p>code,.css-1eveted li>code{background:rgba(255, 229, 100, 0.2);color:inherit;display:inline-block;padding:0 0.3em;}.css-1eveted p>code,.css-1eveted li>code,.css-1eveted p>a>code,.css-1eveted li>a>code{padding:0 3px;font-size:inherit;word-break:break-word;}.css-1eveted h2{border-top:1px solid #ececec;margin-top:2em;padding-top:2em;line-height:1.2;font-size:20px;}.css-1eveted h2:first-of-type{border-top:0;padding-top:0;}@media (min-width: 780px){.css-1eveted h2{font-size:35px;}}.css-1eveted hr+h2{border-top:0;margin-top:0;}.css-1eveted h3{padding-top:45px;font-size:18px;}@media (min-width: 780px){.css-1eveted h3{font-size:25px;line-height:1.3;}}.css-1eveted h2+h3,.css-1eveted h2+h3:first-of-type{padding-top:30px;}.css-1eveted h4{font-size:20px;color:#6d6d6d;line-height:1.3;margin-top:50px;font-weight:400;}.css-1eveted h4+p{margin-top:20px;}.css-1eveted ol,.css-1eveted ul{margin-top:20px;font-size:16px;padding-left:2em;}.css-1eveted ol p,.css-1eveted ul p,.css-1eveted ol p:first-of-type,.css-1eveted ul p:first-of-type{font-size:16px;margin-top:0;line-height:1.2;}.css-1eveted ol li,.css-1eveted ul li{margin-top:10px;}.css-1eveted img{max-width:100%;}.css-1eveted ol{list-style:decimal;}.css-1eveted ul{list-style:disc;}.css-1eveted blockquote{background-color:rgba(255, 229, 100, 0.3);border-left-color:#ffe564;border-left-width:9px;border-left-style:solid;padding:20px 45px 20px 26px;margin:1em 0 2em -1em;}@media (min-width: 780px){.css-1eveted blockquote{margin-left:-2em;}}.css-1eveted blockquote p{margin-top:15px;}.css-1eveted blockquote p:first-of-type{font-weight:700;margin-top:0;}.css-1eveted blockquote p:nth-of-type(2){margin-top:0;}.css-1eveted table{margin:1em auto;border-spacing:0;border-collapse:collapse;width:100%;}@media (min-width: 780px){.css-1eveted table{width:80%;}}.css-1eveted table td,.css-1eveted table th{border:1px solid #ccc;margin:0;padding:0.4em;}.css-1eveted table+legend{border-left:3px solid #ccc;font-size:small;font-style:italic;width:100%;margin:1em auto;padding:0 0 0 1em;}@media (min-width: 780px){.css-1eveted table+legend{width:80%;}}</style><article class="css-1eveted e1lcgljk0"><p>I recently needed to send a big payload to CloudWatch and I managed to increase my chances of staying within the AWS payload size limit by using gzip encoding on the request body with <code>boto3</code>.</p>
<p>Unfortunately, with <code>boto3</code>, gzip encoding is not enabled by default and it can’t be turned on with some simple boolean flag. To make things worse, as of today, there isn’t a great body of documentation or examples available on how to achieve this. Or maybe I am just terrible at <em>googling</em>…</p>
<p>I had to go down the rabbit hole to figure out how to support this use case and, in this article, I want to share what I learned with you.</p>
<h2 id="send-gzipped-metrics-to-cloudwatch-using-boto3" style="position:relative;"><a href="#send-gzipped-metrics-to-cloudwatch-using-boto3" aria-label="send gzipped metrics to cloudwatch using boto3 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Send gzipped metrics to CloudWatch using boto3</h2>
<p>Ok, this is the TLDR; a little gift for the ones in a rush that are looking for a quick <em>copy-pastable</em> solution.</p>
<p>Be aware that the various AWS SDKs are just a convenience layer in front of the AWS HTTP API. Python and <code>boto3</code> are no exception. Every time you are calling a method on a <code>boto3</code> client, you are just sending HTTP requests to AWS behind the scenes…</p>
<p>This is how you can intercept and modify such HTTP requests before they are sent to AWS:</p>
<ol>
<li><code>boto3</code> has a built-in event system that, among other things, allows you to intercept (and even modify) HTTP requests that are ready to be forwarded to AWS.</li>
<li>By using this event system, you can implement an event handler that takes the payload of an outgoing request and gzips it. The same handler can also alter the set of outgoing HTTP headers so that it can indicate the request is gzipped by adding the header <code>Content-Encoding: gzip</code>.</li>
</ol>
<p>Here is a code example that uses a CloudWatch client, intercepts calls to the <code>PutMetricData</code> API, and gzips the request payload:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> boto3
<span class="token keyword">import</span> gzip

<span class="token comment"># Create a CloudWatch client</span>
cw_client <span class="token operator">=</span> boto3<span class="token punctuation">.</span>client<span class="token punctuation">(</span><span class="token string">'cloudwatch'</span><span class="token punctuation">)</span>

<span class="token comment"># Get a reference to the event system for that client</span>
event_system <span class="token operator">=</span> cw_client<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>events

<span class="token comment"># Event handler that takes an arbitrary request and gzips its body</span>
<span class="token keyword">def</span> <span class="token function">gzip_request_body</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    gzipped_body <span class="token operator">=</span> gzip<span class="token punctuation">.</span>compress<span class="token punctuation">(</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
    request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>add_header<span class="token punctuation">(</span><span class="token string">'Content-Encoding'</span><span class="token punctuation">,</span> <span class="token string">'gzip'</span><span class="token punctuation">)</span>
    request<span class="token punctuation">.</span>data <span class="token operator">=</span> gzipped_body

<span class="token comment"># Register the event handler (only for CloudWatch PutMetricData!)</span>
event_system<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'before-sign.cloudwatch.PutMetricData'</span><span class="token punctuation">,</span> gzip_request_body<span class="token punctuation">)</span>

<span class="token comment"># Sends a request</span>
cw_client<span class="token punctuation">.</span>put_metric_data<span class="token punctuation">(</span>
    MetricData <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">'MetricName'</span><span class="token punctuation">:</span> <span class="token string">'KPIs'</span><span class="token punctuation">,</span>
            <span class="token string">'Dimensions'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">'Name'</span><span class="token punctuation">:</span> <span class="token string">'PURCHASES_SERVICE'</span><span class="token punctuation">,</span>
                    <span class="token string">'Value'</span><span class="token punctuation">:</span> <span class="token string">'CoolService'</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    <span class="token string">'Name'</span><span class="token punctuation">:</span> <span class="token string">'APP_VERSION'</span><span class="token punctuation">,</span>
                    <span class="token string">'Value'</span><span class="token punctuation">:</span> <span class="token string">'1.0'</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'Unit'</span><span class="token punctuation">:</span> <span class="token string">'None'</span><span class="token punctuation">,</span>
            <span class="token string">'Value'</span><span class="token punctuation">:</span> <span class="token number">217</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    Namespace<span class="token operator">=</span><span class="token string">'CoolApp'</span>
<span class="token punctuation">)</span></code></pre></div>
<p>You are welcome! 😜</p>
<p>Now, if you are curious to know more about my use case and how the <code>boto3</code> events system works you are more than welcome to keep reading the rest of the article.</p>
<h2 id="the-use-case-sending-custom-metrics-to-cloudwatch" style="position:relative;"><a href="#the-use-case-sending-custom-metrics-to-cloudwatch" aria-label="the use case sending custom metrics to cloudwatch permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The use case: sending custom metrics to CloudWatch</h2>
<p>Last week, during my work at <a href="https://www.fourtheorem.com/">fourTheorem</a>, we started to get intermittent alarms for a Lambda in our stack that was failing because of requests to CloudWatch being occasionally throttled.</p>
<p>Once we looked at the error, the problem was actually quite obvious, but let me give you a simplified overview of what we are doing with this Lambda.</p>
<p>This Lambda is triggered by a Kinesis stream in which we publish custom metric data from all the other components of our application. The Lambda reads these metrics and publishes them to CloudWatch using the <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_PutMetricData.html"><code>PutMetricData</code> API</a>.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 39.453125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIDBf/EABYBAQEBAAAAAAAAAAAAAAAAAAQCA//aAAwDAQACEAMQAAAB04GhKxCP/8QAFRABAQAAAAAAAAAAAAAAAAAAACP/2gAIAQEAAQUCqqq//8QAGBEAAgMAAAAAAAAAAAAAAAAAAAIBAxH/2gAIAQMBAT8BpYl9P//EABgRAAIDAAAAAAAAAAAAAAAAAAECEBEh/9oACAECAQE/AX03H//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABsQAAICAwEAAAAAAAAAAAAAAAABEUEhMVGh/9oACAEBAAE/IXvPcDdPRO8yf//aAAwDAQACAAMAAAAQC+//xAAaEQACAgMAAAAAAAAAAAAAAAAAAREhMWGR/9oACAEDAQE/EMlK9DGmFw//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8QkMf/xAAaEAEAAgMBAAAAAAAAAAAAAAABACERQYGR/9oACAEBAAE/EHjUW45Epihu3pEFRH//2Q=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/af62cb430fc6cab61dc6a1d2eded0eaf/8d3d1/boto3-custom-metrics-kinesis-lambda-cloudwatch.webp 256w,
/static/af62cb430fc6cab61dc6a1d2eded0eaf/354cf/boto3-custom-metrics-kinesis-lambda-cloudwatch.webp 512w,
/static/af62cb430fc6cab61dc6a1d2eded0eaf/44907/boto3-custom-metrics-kinesis-lambda-cloudwatch.webp 1024w"
              sizes="(max-width: 1024px) 100vw, 1024px"
              type="image/webp"
            />
          <source
            srcset="/static/af62cb430fc6cab61dc6a1d2eded0eaf/b95e4/boto3-custom-metrics-kinesis-lambda-cloudwatch.jpg 256w,
/static/af62cb430fc6cab61dc6a1d2eded0eaf/1779b/boto3-custom-metrics-kinesis-lambda-cloudwatch.jpg 512w,
/static/af62cb430fc6cab61dc6a1d2eded0eaf/87945/boto3-custom-metrics-kinesis-lambda-cloudwatch.jpg 1024w"
            sizes="(max-width: 1024px) 100vw, 1024px"
            type="image/jpeg"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/af62cb430fc6cab61dc6a1d2eded0eaf/87945/boto3-custom-metrics-kinesis-lambda-cloudwatch.jpg"
            alt="Schematic of a Kinesis stream being processed by a Lambda to collect metrics and send them to CloudWatch"
            title="Schematic of a Kinesis stream being processed by a Lambda to collect metrics and send them to CloudWatch"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
    </span></p>
<p><small>Note that this idea is coming from <a href="https://github.com/lumigo-io/SAR-async-lambda-metrics">Lumigo’s SAR async Lambda metrics</a>.</small></p>
<p>The issue is that in our original implementation we took the naive approach of submitting 1 data point at a time. Therefore, under load, we would be sending a large number of HTTP requests per second to AWS and we might end up being throttled.</p>
<p>The solution to the problem is actually quite simple: we can reduce the total number of HTTP requests by sending the data in batches containing multiple data points, rather than sending data points one by one.</p>
<p>This is actually possible by using the same <code>PutMetricData</code> API from CloudWatch.</p>
<h2 id="cloudwatch-putmetricdata-limits" style="position:relative;"><a href="#cloudwatch-putmetricdata-limits" aria-label="cloudwatch putmetricdata limits permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CloudWatch <code>PutMetricData</code> limits</h2>
<p>So apparently the solution is simple: we just need to send multiple data points for every single <code>PutMetricData</code> call. But how many?</p>
<p>A call to this API accepts an array of metrics that looks like this:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">'MetricName'</span><span class="token punctuation">:</span> <span class="token string">'SomeMetric1'</span><span class="token punctuation">,</span>
        <span class="token string">'Dimensions'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">'Name'</span><span class="token punctuation">:</span> <span class="token string">'Dimension1Name'</span><span class="token punctuation">,</span>
                <span class="token string">'Value'</span><span class="token punctuation">:</span> <span class="token string">'Dimension1Value'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment"># Up to other 9 dimensions here ...</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'Unit'</span><span class="token punctuation">:</span> <span class="token string">'Count'</span><span class="token punctuation">,</span>
        <span class="token string">'Values'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">217</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">221</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment"># Up to 150 items here ...</span>
        <span class="token string">'Timestamp'</span><span class="token punctuation">:</span> <span class="token number">1624290910000</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment"># Up to other 19 metric items here ...</span>
<span class="token punctuation">]</span></code></pre></div>
<p>More details can be found in the documentation for the <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_MetricDatum.html"><code>MetricDatum</code> type</a>.</p>
<p>As you can tell from the comments in the snippet above, the API has some interesting limits to be considered:</p>
<ul>
<li>Up to <strong>20</strong> different metrics</li>
<li>Up to <strong>10</strong> dimensions per metric</li>
<li>Up to <strong>150 values</strong> per metric</li>
<li>Up to <strong>40 KB</strong> in size for HTTP POST requests</li>
</ul>
<p>So, the best case scenario to reduce the number of <code>PutMetricData</code> requests is to have batches of 20 metrics, but we need to make sure that all this data, once encoded, fits in 40 KB.</p>
<p>Splitting the metrics in chunks of 20 entries per request is not a big deal. But how do we make sure all the other constraints are respected. Especially the payload size one.</p>
<p>The <code>PutMetricData</code> documentation page adds an interesting bit of information:</p>
<blockquote>
<p>You can send a payload compressed by gzip.</p>
</blockquote>
<p>It would be convenient to use gzip compression to increase our chances to stay within boundaries.</p>
<p>At this point, I thought <em>“Ok, probably <code>boto3</code> is automatically doing the compression for us, because why shouldn’t it?”</em></p>
<p>But if you have used AWS for long enough, you learn not to give too many things for granted, so… Let’s test this assumption, first!</p>
<h2 id="testing-boto3-default-behavior" style="position:relative;"><a href="#testing-boto3-default-behavior" aria-label="testing boto3 default behavior permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Testing <code>boto3</code> default behavior</h2>
<p>So, how can we see if the by default <code>boto3</code> is already gzipping our requests?
Requests are going to AWS and I could think of 3 different ways to inspect how the final HTTP request actually looks when sent to AWS:</p>
<ol>
<li>Use a debugger and step through the execution in the deep corners of the <code>boto3</code> code.</li>
<li>Use an HTTP proxy like <a href="https://portswigger.net/burp/communitydownload">Burp Suite</a> to intercept all the outgoing traffic and have a chance to inspect what’s being sent to AWS.</li>
<li>Use the <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/core/session.html#boto3.session.Session.client"><code>endpoint_url</code> parameter</a> to configure the <code>boto3</code> client to send requests somewhere else.</li>
</ol>
<p>I opted for option 3, just because I thought it would be the quickest and easiest for me. I quickly wrote a very simple <a href="https://gist.github.com/lmammino/34373d61ff28ba34c9c26eb1edad5684">HTTP debugging server in Node.js</a> and let it listen for requests at <code>locahost:8000</code>.</p>
<p>At this point I could simply run the following Python code to see how <code>boto3</code> would send a <code>PutMetricData</code> request to AWS:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> boto3
<span class="token keyword">import</span> gzip

endpoint_url <span class="token operator">=</span> <span class="token string">"http://localhost:8000/"</span>

cw_client <span class="token operator">=</span> boto3<span class="token punctuation">.</span>client<span class="token punctuation">(</span><span class="token string">'cloudwatch'</span><span class="token punctuation">,</span> endpoint_url<span class="token operator">=</span>endpoint_url<span class="token punctuation">,</span> use_ssl<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

cw_client<span class="token punctuation">.</span>put_metric_data<span class="token punctuation">(</span>
    MetricData <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">'MetricName'</span><span class="token punctuation">:</span> <span class="token string">'TEST_BOTO'</span><span class="token punctuation">,</span>
            <span class="token string">'Dimensions'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">'Name'</span><span class="token punctuation">:</span> <span class="token string">'APP_VERSION'</span><span class="token punctuation">,</span>
                    <span class="token string">'Value'</span><span class="token punctuation">:</span> <span class="token string">'1.0'</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'Unit'</span><span class="token punctuation">:</span> <span class="token string">'None'</span><span class="token punctuation">,</span>
            <span class="token string">'Value'</span><span class="token punctuation">:</span> <span class="token number">17</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    Namespace<span class="token operator">=</span><span class="token string">'BotoTest'</span>
<span class="token punctuation">)</span></code></pre></div>
<p>Note that I am also using <code>use_ssl=False</code> because my local endpoint supports only plain HTTP.</p>
<p>Ok at this point I used all my confidence in AWS and run this script… This is what I got in my debug web server:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 58.59375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACj0lEQVQoz33Oy1LaUBgH8LyCyC3khEAuQMiNW8BAuCUIOrU+RF+oFbStLqwWtMuuuuxeZnyI7pqpM+10L+ffycHpuHLxm+925vsOd375/mF1tYyWV9fR8vOKuVneRucfL6LF/Cw6XXyI5vOz6ORkEb17u4guzi+j1fJLtFreRKvVLYs3q9ufV5+u/yzmp185wfHA223wZgtE0ZFRVKQVBYJcRl5WIckiCooMrVpDSVehVUQQSUQiTbCTIthhUWD1bobcc4LeQlZ3Nym9RdNSmaYEiSYFiaaFIs1JMuVFifKkQHlRobl8gQqSRHNigaZzEk3x/z2meAnJjHjHVao2FK1KK7oNs+aiYtRhOi6yRGZXE2kRuxmR/SL+UVxvEdaPJbP5DVuYFdec0/TQ6Y2o6w1Qa3lodXx4/hjNjs8WG3YLJd2BVW8zpaoDw2mxXNMdEEkDLyqb7WGy5uxGB/3RhMZLnEYH4fQV/GGIYTBDbxDAsJuoWg1YNZfl8bL4aK25x9RdD7pZ34jFEnhSjBd6aHfHdM8PEed110e93YfhdOI+E89cbwSn2WUa7T5qrR7KZhOiXEVRszZxniXamuu0TXQ9h3p7Ntqugbhu1MowjSJsS2EcW4VtKrBMGTVbg1EtoO6U4FgqLEOObeI3RoWsuWAyw3A8ouMgwHA0wnQ2wygIEO5PMA63vSAMmYPDQ2YwHGIchtifTtHt9TAKxpveIMTxRF1zfb8Nv9fY+L0mPZgNqGOXqGmoTxRGrxRYtC1t2zNVapnq06xI67byePzax1Eg3XECyUEQBYbE8oQRn5O2MZ4/7+clgjSfw7ir4sf3Kd4cCfdcIpP/nUjnH16y89IsRR6Sgvqr3yn9lYTMt38lL3nBP9bkDgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/e859e1b0f48c3bd857582dcfff957736/8d3d1/boto3-no-gzip-by-default.webp 256w,
/static/e859e1b0f48c3bd857582dcfff957736/354cf/boto3-no-gzip-by-default.webp 512w,
/static/e859e1b0f48c3bd857582dcfff957736/44907/boto3-no-gzip-by-default.webp 1024w"
              sizes="(max-width: 1024px) 100vw, 1024px"
              type="image/webp"
            />
          <source
            srcset="/static/e859e1b0f48c3bd857582dcfff957736/85b06/boto3-no-gzip-by-default.png 256w,
/static/e859e1b0f48c3bd857582dcfff957736/bc282/boto3-no-gzip-by-default.png 512w,
/static/e859e1b0f48c3bd857582dcfff957736/f1720/boto3-no-gzip-by-default.png 1024w"
            sizes="(max-width: 1024px) 100vw, 1024px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/e859e1b0f48c3bd857582dcfff957736/f1720/boto3-no-gzip-by-default.png"
            alt="Boto3 does not use gzip compression by default"
            title="Boto3 does not use gzip compression by default"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
    </span></p>
<p>As you can see from the picture above, <code>boto3</code> does not use gzip compression by default.</p>
<p>Sad me… 😢 Time to roll up the sleeves and figure out how to gzip the request body manually!</p>
<h2 id="the-boto3-events-system" style="position:relative;"><a href="#the-boto3-events-system" aria-label="the boto3 events system permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The <code>boto3</code> events system</h2>
<p>After some research, I discovered that <code>boto3</code> has a <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/events.html">built-in event system</a>.</p>
<p>This event system allows you to intercept requests being sent to AWS and alter them before they are sent. You can also intercept responses coming from AWS.</p>
<p>This is not a very well known feature of <code>boto3</code>, but I can see it being useful in a couple of circumstances:</p>
<ul>
<li>Log all outgoing requests and incoming responses (for debugging)</li>
<li>Alter HTTP requests or HTTP responses to and from AWS to implement custom behaviors (gzipping the payload of outgoing requests is a great example).</li>
</ul>
<p>If you want to look at a quick example of how to use this feature, here is one: we want to add an <code>x-trace-id</code> header when we invoke a lambda using <code>boto3</code>:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> boto3

lambda_client <span class="token operator">=</span> boto3<span class="token punctuation">.</span>client<span class="token punctuation">(</span><span class="token string">'lambda'</span><span class="token punctuation">)</span>

<span class="token comment"># our event handler</span>
<span class="token keyword">def</span> <span class="token function">add_xtrace_header</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>add_header<span class="token punctuation">(</span><span class="token string">'x-trace-id'</span><span class="token punctuation">,</span> <span class="token string">'trace-trace'</span><span class="token punctuation">)</span>

<span class="token comment"># get the event system for the lambda_client</span>
event_system <span class="token operator">=</span> lambda_client<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>events

<span class="token comment"># attach an event handler to the client for </span>
event_system<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'before-sign.lambda.Invoke'</span><span class="token punctuation">,</span> add_xtrace_header<span class="token punctuation">)</span>

<span class="token comment"># invoke a lambda function</span>
lambda_client<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>FunctionName<span class="token operator">=</span><span class="token string">'my-function'</span><span class="token punctuation">)</span></code></pre></div>
<p>The example should be pretty straightforward, but let’s zoom on some interesting details.</p>
<ul>
<li>An event handler is just a function that receives a number of arguments that depend on the type of event.</li>
<li>Every <code>boto3</code> client exposes the event system as <code>client.meta.events</code>.</li>
<li>We can register an event handler by using the <code>register</code> function on the event system of a given client and pass the event name and the handler to it.</li>
</ul>
<p>The event name is interesting because it follows this specification:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">&lt;event-type&gt;.&lt;service-name&gt;.&lt;operation-name&gt;</code></pre></div>
<ul>
<li><code>event-type</code> is used to indicate the type of event. This is generally representing a phase of the lifecycle of a request. Some examples are <code>provide-client-params</code>, <code>request-created</code>, <code>before-sign</code>, <code>before-send</code>, and <code>response-received</code>.</li>
<li><code>service-name</code> is the name of the service used. For instance: <code>s3</code> or <code>cloudwatch</code>.</li>
<li><code>operation-name</code> indicates the type of operation the client is trying to perform (the method). For instance: <code>PutMetricData</code> or <code>Invoke</code>.</li>
</ul>
<p>Not all these parts are mandatory and you can create event listeners for multiple events. Let’s look at some examples:</p>
<ul>
<li><code>*</code> will listen to every event</li>
<li><code>after-call.lambda.*</code> (or <code>after-call.lambda</code>) will listen to all <code>after-call</code> type events for lambda and intercept all methods.</li>
</ul>
<p>The <code>botocore</code> documentation isn’t very clear on how these events work, but after some digging, I managed to find the slides of a very interesting talk by <a href="https://twitter.com/thekyleknapp">Kyle Knapp</a> called <a href="https://pages.awscloud.com/rs/112-TZM-766/images/B-4.pdf">Deep Dive on AWS SDK for Python (Boto3)</a>. There’s also <a href="https://www.youtube.com/watch?v=eM8uoGJO2AI">a video available</a>! This one was a real lifesaver for me to understand how all of this works. Thank you, Kyle!</p>
<h2 id="a-boto3-event-handler-for-gzipping-requests" style="position:relative;"><a href="#a-boto3-event-handler-for-gzipping-requests" aria-label="a boto3 event handler for gzipping requests permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A <code>boto3</code> event handler for gzipping requests</h2>
<p>At this point, we know enough to understand how we can add the gzip behavior to our CloudWatch <code>PutMetricData</code> requests.</p>
<p>Let’s update our test example and add a custom event listener:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> boto3
<span class="token keyword">import</span> gzip

endpoint_url <span class="token operator">=</span> <span class="token string">"http://localhost:8000/"</span>

cw_client <span class="token operator">=</span> boto3<span class="token punctuation">.</span>client<span class="token punctuation">(</span><span class="token string">'cloudwatch'</span><span class="token punctuation">,</span>  endpoint_url<span class="token operator">=</span>endpoint_url<span class="token punctuation">,</span> use_ssl<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
event_system <span class="token operator">=</span> cw_client<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>events

<span class="token comment"># Gzip handler</span>
<span class="token keyword">def</span> <span class="token function">gzip_request_body</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    gzipped_body <span class="token operator">=</span> gzip<span class="token punctuation">.</span>compress<span class="token punctuation">(</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
    request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>add_header<span class="token punctuation">(</span><span class="token string">'Content-Encoding'</span><span class="token punctuation">,</span> <span class="token string">'gzip'</span><span class="token punctuation">)</span>
    request<span class="token punctuation">.</span>data <span class="token operator">=</span> gzipped_body

<span class="token comment"># registers the custom handler</span>
event_system<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'before-sign.cloudwatch.PutMetricData'</span><span class="token punctuation">,</span> gzip_request_body<span class="token punctuation">)</span>

response <span class="token operator">=</span> cw_client<span class="token punctuation">.</span>put_metric_data<span class="token punctuation">(</span>
    MetricData <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">'MetricName'</span><span class="token punctuation">:</span> <span class="token string">'TEST_BOTO'</span><span class="token punctuation">,</span>
            <span class="token string">'Dimensions'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">'Name'</span><span class="token punctuation">:</span> <span class="token string">'APP_VERSION'</span><span class="token punctuation">,</span>
                    <span class="token string">'Value'</span><span class="token punctuation">:</span> <span class="token string">'1.0'</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'Unit'</span><span class="token punctuation">:</span> <span class="token string">'None'</span><span class="token punctuation">,</span>
            <span class="token string">'Value'</span><span class="token punctuation">:</span> <span class="token number">17</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    Namespace<span class="token operator">=</span><span class="token string">'BotoTest'</span>
<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span></code></pre></div>
<p>Note that we are using the <code>before-sign</code> event type because we want to alter the request before the signature is applied to the request.</p>
<p>If we run this code and check our debug web server we will see something like this:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 58.59375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACtUlEQVQoz42P227TWBSG/QjT0jixt7e3T4njxIlj144d181RnIS45gXgIXgHpJk2nNoLKCQt4oqreQciMc8x1kQaxD3ZP/Ju4ZqLX+vba23961/S2ZuX2/XFqlxdvCtX79dCl6ur8uz1ebk8fVE+X74qT09flCcny/KvP5fl+dmbcr36UK5Xl+V6fSXq5frq34u3774uT59/kkgwgtIfQvFjaLaHuu1Atm0Qy4VuOWAWhWFbaHYGaHkOmm0KjVHsyxr2ahr2RCXifauufZGIF6PRiXeyF3OZubxGGD8gjNeJyVVmcoUyrmgGV6jNVd3ghDGuUoPLKuM15Ze+1xSGgzr9LLleANPp8FY7QDdI4HYjdPsJ6sT6lWJfpiKFSFSjN70qEf2pnTBs0I2UZkNMZmM+nh6j4izPMJtPMDoq0AuH6IdDeH6E4DBDEKVo+6HoBVEGtzsANV2ourM7aOjXhrfnA9y/m/L5JMDDB3nFuLsIEIYuqOmBmi0o1IZutYUIawoTw/ZAjdaNob2rrrhV1zZSP0wwXdzhxXiOUTHBnXsPcDxdIM3HCOMRHNcXSZx2D7brw/NDkdbrRfAHCXqDBG4n2FmtLghzNlJWLDCIj3iYVCeO0AszDPMZktEE1Sw9miPOJqjm1zyu/gtORlPRD5Ni148ymM3ORprNjpAMIx5GPYRRH8HAR6frghkaDFOHaekwKplUMNVVNFQZDaUGjarQGQHVlV3FtYa2kZI0Q5qlu2J8zA+TmA+zlE/nM1HzouCzxZwfj8d8lOei5/f7PIoPeZbn3LQdrmoaJ3rzu9W0YdvqZ4kyDbpBQJkqUl1vvN78k+kNV7IdA36vjUHow3VN7MkNPH1c4J+P99Fpki8S0en/hNLt70rVtG1dUbayomwJ1bZ/yHT7aEH+e/ak+a3esP/+AQqwdfWBoQeqAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/e8171d352cb387a1948ebedd12bd2e4c/8d3d1/boto3-with-gzip-compression.webp 256w,
/static/e8171d352cb387a1948ebedd12bd2e4c/354cf/boto3-with-gzip-compression.webp 512w,
/static/e8171d352cb387a1948ebedd12bd2e4c/44907/boto3-with-gzip-compression.webp 1024w"
              sizes="(max-width: 1024px) 100vw, 1024px"
              type="image/webp"
            />
          <source
            srcset="/static/e8171d352cb387a1948ebedd12bd2e4c/85b06/boto3-with-gzip-compression.png 256w,
/static/e8171d352cb387a1948ebedd12bd2e4c/bc282/boto3-with-gzip-compression.png 512w,
/static/e8171d352cb387a1948ebedd12bd2e4c/f1720/boto3-with-gzip-compression.png 1024w"
            sizes="(max-width: 1024px) 100vw, 1024px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/e8171d352cb387a1948ebedd12bd2e4c/f1720/boto3-with-gzip-compression.png"
            alt="Boto3 sending gzipped requests using a custom event handler"
            title="Boto3 sending gzipped requests using a custom event handler"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
    </span></p>
<p>Now the requests are compressed! We are sending exactly the same request as before and now it’s sending only <strong>151 bytes</strong> as opposed to <strong>265 bytes</strong> from the original request!</p>
<p>That’s some pretty good compression!</p>
<p>Of course, your mileage might vary depending on the shape of your custom metrics. Figuring out how much data can you actually pack in 40 KB might take a little bit of research. Keep in mind you are still limited to 20 metrics per request and 10 dimensions per metric. Gzipping is only increasing your chances to stay within boundaries if you really have to use a lot of dimensions (maybe with long names) or if you have a lot of values per metric.</p>
<p>Now, if we remove the configuration for <code>endpoint_url</code> and send the request to AWS, we can see that everything still works and that the compressed request is processed correctly:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 48.828125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wgARCAAKABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEDAgb/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHu1hlCIf/EABgQAQEBAQEAAAAAAAAAAAAAAAEAERIx/9oACAEBAAEFAui2GwsI8//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAQEBAQAAAAAAAAAAAAAAAAAxARD/2gAIAQEABj8CXsY//8QAHBAAAgICAwAAAAAAAAAAAAAAAAERITFxQVFh/9oACAEBAAE/IfZFU3DUkiuJ2UKkLoCLFwj/2gAMAwEAAgADAAAAEMAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHhABAQACAAcAAAAAAAAAAAAAAREAITFBUWFxodH/2gAIAQEAAT8QZfbDYHsh9uHdiuhyS7o8scVR1uecJAFZhx1n/9k='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/c6d5fa6d3b4b6a938c3951a76b659185/8d3d1/cloudwatch-metrics-dashboard-from-boto3.webp 256w,
/static/c6d5fa6d3b4b6a938c3951a76b659185/354cf/cloudwatch-metrics-dashboard-from-boto3.webp 512w,
/static/c6d5fa6d3b4b6a938c3951a76b659185/44907/cloudwatch-metrics-dashboard-from-boto3.webp 1024w"
              sizes="(max-width: 1024px) 100vw, 1024px"
              type="image/webp"
            />
          <source
            srcset="/static/c6d5fa6d3b4b6a938c3951a76b659185/b95e4/cloudwatch-metrics-dashboard-from-boto3.jpg 256w,
/static/c6d5fa6d3b4b6a938c3951a76b659185/1779b/cloudwatch-metrics-dashboard-from-boto3.jpg 512w,
/static/c6d5fa6d3b4b6a938c3951a76b659185/87945/cloudwatch-metrics-dashboard-from-boto3.jpg 1024w"
            sizes="(max-width: 1024px) 100vw, 1024px"
            type="image/jpeg"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/c6d5fa6d3b4b6a938c3951a76b659185/87945/cloudwatch-metrics-dashboard-from-boto3.jpg"
            alt="Cloudwatch custom metrics dashboard with data sent from boto3"
            title="Cloudwatch custom metrics dashboard with data sent from boto3"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
    </span></p>
<p>Success!</p>
<h2 id="a-few-ideas-for-more-defensive-solutions" style="position:relative;"><a href="#a-few-ideas-for-more-defensive-solutions" aria-label="a few ideas for more defensive solutions permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A few ideas for more defensive solutions</h2>
<p>Compressing the payload for <code>PutMetricData</code> requests is not an absolute guarantee that we won’t be exceeding the 40 KB payload limit. Gzip certainly helps, but you might still bump into the limit and have failures in your application.</p>
<p>If you want to be <em>failure-proof</em> ™️, here are some ideas that we explored with our colleagues:</p>
<ul>
<li>Optimistic solution: Try the request and catch potential exceptions. If you see the <code>PutMetricData</code> failed because the payload is too large, just split all the data into 2 requests.</li>
<li>Pessimistic solution: pre-compute the gzipped payload before sending the request and if that’s bigger than 40 KB, then split the request into 2 parts.</li>
</ul>
<p>The pessimistic solution has the disadvantage that you will be gzipping the payload twice (before you create the request to make sure it’s within boundaries and then in your event handler), but it will avoid sending invalid requests upfront.</p>
<p>Right now, we haven’t implemented any of these strategies. In our case, these metrics are not business-critical and we can afford some sparse failure, so we preferred to keep the code as simple as possible.</p>
<p>If, later on, we will observe production errors, then it might be worth applying one of these strategies. I am more in favor of the optimistic approach because I expect it will be pretty rare to bump into this limit.</p>
<p>What do you think, which strategy would you apply? Do you have other ideas? let me know that in the comments box below! 😁</p>
<h2 id="extensibility-in-the-aws-sdk" style="position:relative;"><a href="#extensibility-in-the-aws-sdk" aria-label="extensibility in the aws sdk permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Extensibility in the AWS SDK</h2>
<p><strong>UPDATE</strong>: It turns out that also with other languages like PHP, Go and JavaScript, the AWS SDK offers some degree of extensibility that should allow you to accomplish something similar to what was discussed in this post.</p>
<p>If you are using any of these other languages you can consult the following resources:</p>
<ul>
<li><a href="https://aws.github.io/aws-sdk-go-v2/docs/middleware/">Customizing the AWS SDK for Go V2 Client Requests</a></li>
<li><a href="https://aws.amazon.com/blogs/developer/middleware-stack-modular-aws-sdk-js/">Introducing Middleware Stack in Modular AWS SDK for JavaScript</a></li>
<li><a href="https://docs.aws.amazon.com/sdk-for-php/v3/developer-guide/guide_handlers-and-middleware.html">Handlers and Middleware in the AWS SDK for PHP Version 3</a></li>
</ul>
<p>Thanks a lot to the following (amazing) people at AWS for helping me to find out this information in the huge haystack that is the AWS documentation: <a href="https://twitter.com/danilop">Danilo Poccia</a>, <a href="https://twitter.com/heitor_lessa">Heitor Lessa</a>, and <a href="https://twitter.com/trivikram">Trivikram</a>. You rock! 🤘</p>
<h2 id="conclusion" style="position:relative;"><a href="#conclusion" aria-label="conclusion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>The event system in <code>boto3</code> is pretty powerful and it allows you to customize the default behavior of how clients will send HTTP requests to AWS.</p>
<p>In this article, we saw how that can be useful for inspecting how AWS APIs are actually used or to add additional functionality that isn’t supported out of the box (e.g. gzipping the HTTP payload of outgoing requests).</p>
<p>If you found this article useful <a href="https://twitter.com/loige">consider following me on Twitter</a> and feel more than welcome to leave a comment below. I’d be really curious to find out what was your use case and if this article helped you out.</p>
<p>A huge “thank you” goes to my colleague <a href="https://twitter.com/martinbpeters">Martin</a> for involving me in this piece of work (and indirectly for dragging me into this rabbit hole 🐇)! Also thanks to <a href="https://twitter.com/eoins">Eoin Shanaghy</a> for kindly reviewing this article! Finally, thanks to <a href="https://twitter.com/benbridts">Ben Bridts</a> for reporting an error in one of the examples! 🙏</p>
<p>See you soon! 👋</p>
<h3 id="about-fourtheorem" style="position:relative;"><a href="#about-fourtheorem" aria-label="about fourtheorem permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>About fourTheorem</h3>
<p>If you want to know more about <a href="https://www.fourtheorem.com/">fourTheorem</a>, we are a team of business-focused technologists that deliver. We have been helping a dozen companies to get the best out of AWS and we had a lot of fun while doing that. If you are curious to know more about what we do you can check out some of our <a href="https://www.fourtheorem.com/case-studies">case studies</a> and our <a href="https://www.fourtheorem.com/customers">customer success stories</a>.</p>
<p>If you would like to work with us, don’t be shy, <a href="https://www.fourtheorem.com/contact">we’d love to get in touch with you</a>! 🙂</p></article><style data-emotion="css 1bhol7z">.css-1bhol7z{margin:2em 0;line-height:25px;padding:1em;font-size:small;border-radius:8px;background:rgba(255, 229, 100, 0.3);}.css-1bhol7z a{-webkit-text-decoration:none;text-decoration:none;border-bottom:2px solid #ffe564;color:inherit;}.css-1bhol7z a:hover{border-bottom:2px solid #ff9b51;}@media (min-width: 780px){.css-1bhol7z{padding:2em 2em;}}</style><div class="css-1bhol7z ep8980s0"><strong>Found a typo or something that can be improved?</strong><br/>In the spirit of Open Source, you can contribute to this article by<!-- --> <a href="https://github.com/lmammino/loige.co/blob/master/content/posts/2021-06-22_how-to-send-gzipped-requests-with-boto3/index.md" target="_blank" rel="noopener noreferrer">submitting a PR on <svg aria-label="GitHub" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg> GitHub</a></div><div style="border-top:1px solid #ececec;margin-top:2em;padding-top:2em;line-height:1.2" class="css-t2ycg8 ep8980s1"><h2 id="comments"><svg aria-hidden="true" data-prefix="fas" data-icon="comments" class="svg-inline--fa fa-comments fa-w-18" viewBox="0 0 576 512" width="1em" height="1em" style="margin:0 .25em 0 0"><path fill="currentColor" d="M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"></path></svg> Comments</h2><div id="disqus_thread"></div></div></main><style data-emotion="css 1n0r681">.css-1n0r681{-webkit-flex:1;-ms-flex:1;flex:1;background:#f7f7f7;padding:1em;margin:0 0 2em 0;}.css-1n0r681 h3{margin:0 0 0.5em 0;position:relative;color:#111;}@media (min-width: 780px){.css-1n0r681{background:transparent;margin:0 0 1em 0;}.css-1n0r681>div{margin:1em 0 0 0;position:-webkit-sticky;position:sticky;overflow-y:auto;top:70px;}}</style><aside class="css-1n0r681 e1kc7zwr0"><style data-emotion="css 1jztyo0">.css-1jztyo0{background:#ffffcd;padding:0.5em;font-size:12px;display:block;color:inherit;-webkit-text-decoration:none;text-decoration:none;border:1px solid #ffffcd;margin:0 0 1em 0;}.css-1jztyo0:hover{border-color:#f89000;}</style><a href="https://www.nodejsdesignpatterns.com/" class="css-1jztyo0 e1pruv502"><style data-emotion="css jovua5">.css-jovua5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}</style><span class="css-jovua5 e1pruv501"><style data-emotion="css 1mvr8gq">.css-1mvr8gq{width:50%;padding:0 0 0 1em;display:block;}.css-1mvr8gq.left{max-width:125px;padding:0 0 0 1em!important;}@media (max-width: 1024px) and (min-width: 780px){.css-1mvr8gq{width:100%;max-width:auto!important;margin:0;}.css-1mvr8gq.left{padding:0 0 0 1em;}.css-1mvr8gq h4{padding:1em 0 0.5em 0!important;}}.css-1mvr8gq:first-of-type{padding:0;}.css-1mvr8gq h4{padding:0 0 0.5em 0;font-size:14px;}</style><span class="left css-1mvr8gq e1pruv500"><img src="/static/200-1cf8c01eb1b97df13cb6f6f3f36de3c0.jpg" style="width:100%" alt="Node.js Design Patterns Third Edition"/></span><span class="css-1mvr8gq e1pruv500"><h4>Node.js Design Patterns</h4><p>Design and implement production-grade <strong>Node.js</strong> <!-- -->applications using proven patterns and techniques with<!-- --> <em>Node.js Design Patterns Third Edition</em>. Available as<!-- --> <strong>Digital</strong> and <strong>Print</strong>.</p></span></span></a><div><style data-emotion="css exth3p">.css-exth3p ol{color:#6d6d6d;padding:0 0 0 2em;list-style:decimal-leading-zero;}.css-exth3p ol ol{padding:0 0 0 0.3em;}.css-exth3p ol li{font-size:0.8rem;font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace;margin-top:5px;color:#111;}.css-exth3p ol li a{font-size:1.2em;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;color:#6d6d6d;border-bottom:1px solid transparent;-webkit-text-decoration:none;text-decoration:none;font-weight:bold;}.css-exth3p ol li a:hover{color:#000;outline-width:0;}.css-exth3p ol li.depth-3{font-size:0.8em;list-style:none;}</style><div class="css-exth3p eu4hp7r0"><h3>Sections</h3><ol><li class="depth-2"><a href="#send-gzipped-metrics-to-cloudwatch-using-boto3">Send gzipped metrics to CloudWatch using boto3</a></li><li class="depth-2"><a href="#the-use-case-sending-custom-metrics-to-cloudwatch">The use case: sending custom metrics to CloudWatch</a></li><li class="depth-2"><a href="#cloudwatch-putmetricdata-limits">CloudWatch PutMetricData limits</a></li><li class="depth-2"><a href="#testing-boto3-default-behavior">Testing boto3 default behavior</a></li><li class="depth-2"><a href="#the-boto3-events-system">The boto3 events system</a></li><li class="depth-2"><a href="#a-boto3-event-handler-for-gzipping-requests">A boto3 event handler for gzipping requests</a></li><li class="depth-2"><a href="#a-few-ideas-for-more-defensive-solutions">A few ideas for more defensive solutions</a></li><li class="depth-2"><a href="#extensibility-in-the-aws-sdk">Extensibility in the AWS SDK</a></li><li class="depth-2"><a href="#conclusion">Conclusion</a><ol><li class="depth-3"><a href="#about-fourtheorem">About fourTheorem</a></li></ol></li></ol></div><h3 style="margin-top:1em">Share</h3><style data-emotion="css 125xt49">.css-125xt49{list-style:none;font-size:30px;padding:0.2em 0;}.css-125xt49 li{display:inline-block;margin:0 0.2em 0 0;}.css-125xt49 li a{color:#6d6d6d;}.css-125xt49 li a.twitter:hover{color:#00aced;}.css-125xt49 li a.facebook:hover{color:#3b5998;}.css-125xt49 li a.linkedin:hover{color:#007bb6;}.css-125xt49 li a.pinterest:hover{color:#cb2027;}.css-125xt49 li a.email:hover{color:black;}</style><ul class="css-125xt49 ey4v4xz0"><li><a rel="nofollow noopener noreferrer" class="twitter" target="_blank" href="https://twitter.com/intent/tweet?text=How%20to%20send%20gzipped%20requests%20with%20boto3&amp;url=https%3A%2F%2Floige.co%2Fhow-to-send-gzipped-requests-with-boto3%2F&amp;source=https%3A%2F%2Floige.co&amp;related=loige&amp;via=loige" title="Share via twitter"><svg aria-label="Twitter" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M23.954 4.569a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.691 8.094 4.066 6.13 1.64 3.161a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.061a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.937 4.937 0 0 0 4.604 3.417 9.868 9.868 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63a9.936 9.936 0 0 0 2.46-2.548l-.047-.02z"></path></svg></a></li><li><a rel="nofollow noopener noreferrer" class="facebook" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Floige.co%2Fhow-to-send-gzipped-requests-with-boto3%2F" title="Share via facebook"><svg aria-hidden="true" data-prefix="fab" data-icon="facebook-square" class="svg-inline--fa fa-facebook-square fa-w-14" viewBox="0 0 448 512" width="1em" height="1em"><path fill="currentColor" d="M448 80v352c0 26.5-21.5 48-48 48h-85.3V302.8h60.6l8.7-67.6h-69.3V192c0-19.6 5.4-32.9 33.5-32.9H384V98.7c-6.2-.8-27.4-2.7-52.2-2.7-51.6 0-87 31.5-87 89.4v49.9H184v67.6h60.9V480H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48z"></path></svg></a></li><li><a rel="nofollow noopener noreferrer" class="linkedin" target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Floige.co%2Fhow-to-send-gzipped-requests-with-boto3%2F&amp;title=How%20to%20send%20gzipped%20requests%20with%20boto3&amp;source=https%3A%2F%2Floige.co" title="Share via linkedin"><svg aria-hidden="true" data-prefix="fab" data-icon="linkedin-in" class="svg-inline--fa fa-linkedin-in fa-w-14" viewBox="0 0 448 512" width="1em" height="1em"><path fill="currentColor" d="M100.3 480H7.4V180.9h92.9V480zM53.8 140.1C24.1 140.1 0 115.5 0 85.8 0 56.1 24.1 32 53.8 32c29.7 0 53.8 24.1 53.8 53.8 0 29.7-24.1 54.3-53.8 54.3zM448 480h-92.7V334.4c0-34.7-.7-79.2-48.3-79.2-48.3 0-55.7 37.7-55.7 76.7V480h-92.8V180.9h89.1v40.8h1.3c12.4-23.5 42.7-48.3 87.9-48.3 94 0 111.3 61.9 111.3 142.3V480z"></path></svg></a></li><li><a rel="nofollow noopener noreferrer" class="pinterest" target="_blank" href="https://pinterest.com/pin/create/button/?media=https%3A%2F%2Floige.co%2Fstatic%2F8b41b98bf31055ba99f44b3531680e24%2Fhow-to-send-gzipped-requests-with-boto3-luciano-mammino-loige.jpg&amp;url=https%3A%2F%2Floige.co%2Fhow-to-send-gzipped-requests-with-boto3%2F&amp;is_video=false&amp;description=How%20to%20send%20gzipped%20requests%20with%20boto3" title="Share via pinterest"><svg aria-hidden="true" data-prefix="fab" data-icon="pinterest" class="svg-inline--fa fa-pinterest fa-w-16" viewBox="0 0 496 512" width="1em" height="1em"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6 0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8 0 128.7-68.8 128.7-154.3 0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1 0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6 0-54.7 41.4-107.6 112-107.6 60.9 0 103.6 41.5 103.6 100.9 0 67.1-33.9 113.6-78 113.6-24.3 0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6 0-19-10.2-34.9-31.4-34.9-24.9 0-44.9 25.7-44.9 60.2 0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9 0 361.1 0 256 0 119 111 8 248 8s248 111 248 248z"></path></svg></a></li><li><a rel="nofollow noopener noreferrer" class="email" target="_blank" href="/cdn-cgi/l/email-protection#d2edf4b3bfa2e9b0bdb6abeff7e2939abda5f7e0e2a6bdf7e0e2a1b7bcb6f7e0e2b5a8bba2a2b7b6f7e0e2a0b7a3a7b7a1a6a1f7e0e2a5bba6baf7e0e2b0bda6bde1f7e293f7e293baa6a6a2a1f7e193f7e094f7e094bebdbbb5b7fcb1bdf7e094babda5ffa6bdffa1b7bcb6ffb5a8bba2a2b7b6ffa0b7a3a7b7a1a6a1ffa5bba6baffb0bda6bde1f7e094f4b3bfa2e9a1a7b0b8b7b1a6ef9abda5f7e0e2a6bdf7e0e2a1b7bcb6f7e0e2b5a8bba2a2b7b6f7e0e2a0b7a3a7b7a1a6a1f7e0e2a5bba6baf7e0e2b0bda6bde1" title="Share via email"><svg aria-hidden="true" data-prefix="far" data-icon="envelope" class="svg-inline--fa fa-envelope fa-w-16" viewBox="0 0 512 512" width="1em" height="1em"><path fill="currentColor" d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"></path></svg></a></li></ul><h3 style="margin-top:1em">Similar posts</h3><style data-emotion="css 11m37pp">.css-11m37pp{color:#6d6d6d;list-style:outside;padding:0 0 0 1.25em;}.css-11m37pp li{margin:0.75em 0 0 0;}.css-11m37pp li:first-of-type{margin-top:0;}.css-11m37pp a{color:#6d6d6d;-webkit-text-decoration:none;text-decoration:none;font-weight:bold;}.css-11m37pp a:hover{color:#000;}</style><ul class="css-11m37pp e1empo690"><li><a href="/provision-ubuntu-ec2-with-cdk">Provision an Ubuntu-based EC2 instance with CDK</a></li><li><a href="/aws-solution-architect-associate-exam-notes-tips">AWS Solution Architect Associate exam, my notes and tips</a></li><li><a href="/aws-command-line-s3-content-from-stdin-or-to-stdout">AWS Command line: S3 content from stdin or to stdout</a></li><li><a href="/from-bare-metal-to-serverless">From bare metal to Serverless</a></li><li><a href="/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn">Using Let’s Encrypt and Certbot to automate the creation of certificates for OpenVPN</a></li></ul></div></aside></div></section></div><style data-emotion="css 1ywtb7p">.css-1ywtb7p{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;list-style:none;padding:0;font-size:14px;min-height:260px;}@media (min-width: 780px){.css-1ywtb7p{-webkit-box-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;font-size:16px;}}@media (min-width: 1024px){.css-1ywtb7p{height:300px;font-size:18px;}}</style><ul class="css-1ywtb7p e191jpam2"><style data-emotion="css 92w3s3">.css-92w3s3{width:100%;text-align:center;min-height:100%;background:black;-webkit-background-size:cover;background-size:cover;}.css-92w3s3 a{-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;background:rgba(0, 0, 0, 0.8);height:100%;-webkit-transition:background 0.5s ease;transition:background 0.5s ease;padding:1em;}.css-92w3s3 a:hover{background:rgba(0, 0, 0, 0.3);}.css-92w3s3 a h4{color:#fff;font-size:1.2em;}.css-92w3s3 a p{color:rgba(255, 255, 255, 0.8);font-size:0.8em;vertical-align:middle;line-height:1em;}.css-92w3s3 a p svg{vertical-align:text-bottom;}</style><li style="background-image:url(/static/649c60b4c80a9dfcc1a2c8749ec4b347/how-to-to-string-in-rust.jpg)" class="css-92w3s3 e191jpam1"><a rel="prev" href="/how-to-to-string-in-rust"><style data-emotion="css 16g7a2l">.css-16g7a2l{display:inline-block;padding:4px 10px 5px;text-transform:uppercase;font-size:0.8em;color:rgba(255, 255, 255, 0.8);}</style><span class="css-16g7a2l e191jpam0">Read this next</span><h4>How to to_string in Rust</h4><p><svg aria-hidden="true" data-prefix="far" data-icon="eye" class="svg-inline--fa fa-eye fa-w-18" viewBox="0 0 576 512" width="1em" height="1em"><path fill="currentColor" d="M569.354 231.631C512.97 135.949 407.81 72 288 72 168.14 72 63.004 135.994 6.646 231.631a47.999 47.999 0 0 0 0 48.739C63.031 376.051 168.19 440 288 440c119.86 0 224.996-63.994 281.354-159.631a47.997 47.997 0 0 0 0-48.738zM288 392c-102.556 0-192.091-54.701-240-136 44.157-74.933 123.677-127.27 216.162-135.007C273.958 131.078 280 144.83 280 160c0 30.928-25.072 56-56 56s-56-25.072-56-56l.001-.042C157.794 179.043 152 200.844 152 224c0 75.111 60.889 136 136 136s136-60.889 136-136c0-31.031-10.4-59.629-27.895-82.515C451.704 164.638 498.009 205.106 528 256c-47.908 81.299-137.444 136-240 136z"></path></svg> <!-- -->11<!-- --> minutes read</p></a></li><li style="background-image:url(/static/9e5e2056046a128d577fe018946df76b/provision-ubuntu-ec2-with-cdk-luciano-mammino-loige.jpg)" class="css-92w3s3 e191jpam1"><a rel="next" href="/provision-ubuntu-ec2-with-cdk"><span class="css-16g7a2l e191jpam0">You might enjoy</span><h4>Provision an Ubuntu-based EC2 instance with CDK</h4><p><svg aria-hidden="true" data-prefix="far" data-icon="eye" class="svg-inline--fa fa-eye fa-w-18" viewBox="0 0 576 512" width="1em" height="1em"><path fill="currentColor" d="M569.354 231.631C512.97 135.949 407.81 72 288 72 168.14 72 63.004 135.994 6.646 231.631a47.999 47.999 0 0 0 0 48.739C63.031 376.051 168.19 440 288 440c119.86 0 224.996-63.994 281.354-159.631a47.997 47.997 0 0 0 0-48.738zM288 392c-102.556 0-192.091-54.701-240-136 44.157-74.933 123.677-127.27 216.162-135.007C273.958 131.078 280 144.83 280 160c0 30.928-25.072 56-56 56s-56-25.072-56-56l.001-.042C157.794 179.043 152 200.844 152 224c0 75.111 60.889 136 136 136s136-60.889 136-136c0-31.031-10.4-59.629-27.895-82.515C451.704 164.638 498.009 205.106 528 256c-47.908 81.299-137.444 136-240 136z"></path></svg> <!-- -->17<!-- --> minutes read</p></a></li></ul><style data-emotion="css 98dwl5">.css-98dwl5{background-color:#20232a;color:#ffffff;padding-top:30px;padding-bottom:50px;position:relative;}</style><footer class="css-98dwl5 ecf9mth10"><style data-emotion="css rxhh6g">.css-rxhh6g{position:absolute;width:100%;top:0;height:2px;display:block;transform-origin:left center 0px;-webkit-transform:scaleX(1);-moz-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);z-index:50;-webkit-transition:-webkit-transform 400ms ease 100ms;transition:transform 400ms ease 100ms;background:linear-gradient(90deg, #46c9e5, #d26ac2);}</style><span class="css-rxhh6g ecf9mth9"></span><style data-emotion="css 1tjci2f">.css-1tjci2f{padding-left:20px;padding-right:20px;max-width:1260px;margin-left:auto;margin-right:auto;}@media (min-width: 780px){.css-1tjci2f{width:90%;}}</style><div class="css-1tjci2f ecf9mth8"><style data-emotion="css y6mpu4">.css-y6mpu4{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}</style><div class="css-y6mpu4 ecf9mth7"><style data-emotion="css 17fog7c">.css-17fog7c{-webkit-flex:1 auto;-ms-flex:1 auto;flex:1 auto;margin-bottom:1em;padding-right:1em;width:100%;}@media (min-width: 780px){.css-17fog7c{width:auto;}}</style><div class="css-17fog7c ecf9mth5"><style data-emotion="css mhff0s">.css-mhff0s{color:#d26ac2;font-size:14px;font-weight:bold;line-height:3;text-transform:uppercase;letter-spacing:0.08em;}</style><div style="color:#46c9e5" class="css-mhff0s ecf9mth3">Loige.co</div><style data-emotion="css 15vbtor">.css-15vbtor{font-size:0.8em;padding:4px 0 0 0;color:#ccc;}.css-15vbtor a{color:inherit;font-weight:bold;-webkit-text-decoration:none;text-decoration:none;}.css-15vbtor a:hover{color:#46c9e5;-webkit-text-decoration:underline;text-decoration:underline;}</style><p class="css-15vbtor ecf9mth1">Copyright © Luciano Mammino 2014-<!-- -->2021<!-- -->.</p><p class="css-15vbtor ecf9mth1">Built with<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="https://www.gatsbyjs.org">Gatsby</a>, Coffee and a lot of <style data-emotion="css 12awzcx">.css-12awzcx{color:#d26ac2;}.css-12awzcx:hover{color:red;}</style><span class="css-12awzcx ecf9mth0">❤︎</span>.</p><p class="css-15vbtor ecf9mth1">Loige logo designed by<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="http://andreamangano.com">Andrea Mangano</a>.</p><p class="css-15vbtor ecf9mth1">Hosted on<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="https://github.com/lmammino/loige.co">GitHub</a>, accelerated by<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="https://www.cloudflare.com">Cloudflare</a>.</p><p class="css-15vbtor ecf9mth1">Theme inspired by<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="https://reactjs.org/docs/">React documentation.</a></p><p class="css-15vbtor ecf9mth1">Icons by<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="https://fontawesome.com/">Font Awesome</a>.</p></div><style data-emotion="css fhit9x">.css-fhit9x{-webkit-flex:1 auto;-ms-flex:1 auto;flex:1 auto;margin-bottom:1em;padding-right:1em;}</style><div class="css-fhit9x ecf9mth6"><style data-emotion="css dnp3pp">.css-dnp3pp{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><div class="css-dnp3pp ecf9mth4"><div class="css-mhff0s ecf9mth3">Explore</div><style data-emotion="css 1ez8siy">.css-1ez8siy{color:inherit;line-height:2;-webkit-text-decoration:none;text-decoration:none;}.css-1ez8siy:hover{color:#46c9e5;}</style><a href="/" class="css-1ez8siy ecf9mth2">Blog</a><a href="/speaking" class="css-1ez8siy ecf9mth2">Speaking</a><a href="/about" class="css-1ez8siy ecf9mth2">About</a><a href="/comment-policy" class="css-1ez8siy ecf9mth2">Comment Policy</a></div></div><div class="css-fhit9x ecf9mth6"><div class="css-dnp3pp ecf9mth4"><div class="css-mhff0s ecf9mth3">My Projects</div><a target="_blank" rel="nofollow noopener noreferrer" href="https://www.nodejsdesignpatterns.com" class="css-1ez8siy ecf9mth2">Node.js Design Patterns</a><a target="_blank" rel="nofollow noopener noreferrer" href="https://serverlesslab.com" class="css-1ez8siy ecf9mth2">ServerlessLab</a><a target="_blank" rel="nofollow noopener noreferrer" href="https://fullstackbulletin.com" class="css-1ez8siy ecf9mth2">FullStack Bulletin</a><a target="_blank" rel="nofollow noopener noreferrer" href="https://middy.js.org" class="css-1ez8siy ecf9mth2">Middy</a></div></div><div class="css-fhit9x ecf9mth6"><div class="css-dnp3pp ecf9mth4"><div class="css-mhff0s ecf9mth3">Follow me</div><a rel="nofollow noopener noreferrer" href="https://twitter.com/loige" class="css-1ez8siy ecf9mth2"><svg aria-label="Twitter" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M23.954 4.569a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.691 8.094 4.066 6.13 1.64 3.161a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.061a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.937 4.937 0 0 0 4.604 3.417 9.868 9.868 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63a9.936 9.936 0 0 0 2.46-2.548l-.047-.02z"></path></svg> Twitter</a><a rel="nofollow noopener noreferrer" href="https://twitch.tv/loige" class="css-1ez8siy ecf9mth2"><svg aria-label="Twitch" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M.975 4.175v16.694h5.749V24h3.139l3.134-3.132h4.705l6.274-6.258V0H2.542zm3.658-2.09h17.252v11.479l-3.66 3.652h-5.751L9.34 20.343v-3.127H4.633z"></path><path fill="currentColor" d="M10.385 6.262h2.09v6.26h-2.09zM16.133 6.262h2.091v6.26h-2.091z"></path></svg> Twitch</a><a rel="nofollow noopener noreferrer" href="https://www.youtube.com/channel/UCL0w2IAjTBx3NNka-l7InPw" class="css-1ez8siy ecf9mth2"><svg aria-label="Youtube" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M23.469 5.929l.03.196a3.043 3.043 0 0 0-2.068-2.112l-.021-.005c-1.871-.508-9.4-.508-9.4-.508s-7.51-.01-9.4.508A3.044 3.044 0 0 0 .527 6.104l-.005.021c-.699 3.651-.704 8.038.031 11.947l-.031-.198a3.043 3.043 0 0 0 2.068 2.112l.021.005c1.869.509 9.4.509 9.4.509s7.509 0 9.4-.509a3.043 3.043 0 0 0 2.084-2.096l.005-.021c.318-1.698.5-3.652.5-5.648l-.001-.221.001-.23c0-1.997-.182-3.951-.531-5.846zM9.608 15.651V8.358l6.266 3.652z"></path></svg> Youtube</a><a rel="nofollow noopener noreferrer" href="https://www.linkedin.com/in/lucianomammino" class="css-1ez8siy ecf9mth2"><svg aria-label="LinkedIn" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg> Linkedin</a><a rel="nofollow noopener noreferrer" href="https://github.com/lmammino" class="css-1ez8siy ecf9mth2"><svg aria-label="GitHub" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg> GitHub</a></div></div></div></div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-47248506-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/how-to-send-gzipped-requests-with-boto3/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-e4ec0435b44fba9b8b39.js"],"app":["/app-514e309b4e51a67a0ada.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-4c9ab4251958cf3dbd2c.js"],"component---content-pages-about-js":["/component---content-pages-about-js-4633ff8e8e6a282a19b1.js"],"component---content-pages-comment-policy-js":["/component---content-pages-comment-policy-js-3c6a39721512017d8ec9.js"],"component---src-pages-404-js":["/component---src-pages-404-js-dc2b10ea69db3388f05e.js"],"component---src-templates-blog-index-js":["/component---src-templates-blog-index-js-53d33cfd3e02466e4117.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-f8a40d902eea460a8b7d.js"],"component---src-templates-blog-post-share-image-js":["/component---src-templates-blog-post-share-image-js-05c00175dfd3cda6599c.js"],"component---src-templates-speaking-index-js":["/component---src-templates-speaking-index-js-fd364170d3dbe5d3a93d.js"],"component---src-templates-tag-index-js":["/component---src-templates-tag-index-js-3552ab9114277143e61a.js"]};/*]]>*/</script><script src="/polyfill-e4ec0435b44fba9b8b39.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-f8a40d902eea460a8b7d.js" async=""></script><script src="/4d6423837748823c19bdd3076c1db680baba727b-30a9131768be883bb7a1.js" async=""></script><script src="/850935577dc6138b95e5bc3f6f1d9b06bd36398e-bd6be05cfb6becde2e63.js" async=""></script><script src="/ab670281d767243777119348a2b810446e7309bb-19b089964506eaf24367.js" async=""></script><script src="/app-514e309b4e51a67a0ada.js" async=""></script><script src="/framework-9d9eff57288a5d76d992.js" async=""></script><script src="/webpack-runtime-0019acd3e3ba19e6ba77.js" async=""></script></body></html>