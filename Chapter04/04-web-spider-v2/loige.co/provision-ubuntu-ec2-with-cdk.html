<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 3.7.2"/><script>/**
──────────────███████──███████
──────────████▓▓▓▓▓▓████░░░░░██
────────██▓▓▓▓▓▓▓▓▓▓▓▓██░░░░░░██
──────██▓▓▓▓▓▓████████████░░░░██
────██▓▓▓▓▓▓████████████████░██
────██▓▓████░░░░░░░░░░░░██████              MAMMA MIA!
──████████░░░░░░██░░██░░██▓▓▓▓██
──██░░████░░░░░░██░░██░░██▓▓▓▓██   If you are looking here you
██░░░░██████░░░░░░░░░░░░░░██▓▓██      should definitely get
██░░░░░░██░░░░██░░░░░░░░░░██▓▓██       in touch with me on
──██░░░░░░░░░███████░░░░██████           twitter: @loige
────████░░░░░░░███████████▓▓██
──────██████░░░░░░░░░░██▓▓▓▓██
────██▓▓▓▓██████████████▓▓██
──██▓▓▓▓▓▓▓▓████░░░░░░████
████▓▓▓▓▓▓▓▓██░░░░░░░░░░██
████▓▓▓▓▓▓▓▓██░░░░░░░░░░██
██████▓▓▓▓▓▓▓▓██░░░░░░████████
──██████▓▓▓▓▓▓████████████████
────██████████████████████▓▓▓▓██
──██▓▓▓▓████████████████▓▓▓▓▓▓██
████▓▓██████████████████▓▓▓▓▓▓██
██▓▓▓▓██████████████████▓▓▓▓▓▓██
██▓▓▓▓██████████──────██▓▓▓▓████
██▓▓▓▓████──────────────██████
──████
**/</script><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="alternate" type="application/rss+xml" title="Luciano Mammino &quot;Loige&quot; - FullStack &amp; Cloud developer, fighter, butterfly maker!" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=e5514a6b277bf3f1409d8b0190e93509" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#20232a"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=e5514a6b277bf3f1409d8b0190e93509"/><title data-react-helmet="true">Provision an Ubuntu-based EC2 instance with CDK</title><link data-react-helmet="true" type="text/plain" rel="author" href="https://loige.co/humans.txt"/><link data-react-helmet="true" rel="canonical" content="https://loige.co/provision-ubuntu-ec2-with-cdk/"/><meta data-react-helmet="true" name="description" content="You are using CDK and you need to provision an EC2 instance. What if you prefer to use Ubuntu over Amazon Linux? In this article, we will…"/><meta data-react-helmet="true" name="image" content="https://loige.co/static/f2dd79f9a3e4efc02149a5514432e86c/provision-ubuntu-ec2-with-cdk-fb.png"/><meta data-react-helmet="true" property="og:url" content="https://loige.co/provision-ubuntu-ec2-with-cdk/"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Provision an Ubuntu-based EC2 instance with CDK"/><meta data-react-helmet="true" property="og:description" content="You are using CDK and you need to provision an EC2 instance. What if you prefer to use Ubuntu over Amazon Linux? In this article, we will…"/><meta data-react-helmet="true" property="og:image" content="https://loige.co/static/f2dd79f9a3e4efc02149a5514432e86c/provision-ubuntu-ec2-with-cdk-fb.png"/><meta data-react-helmet="true" property="fb:app_id" content="231187154413670"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="loige"/><meta data-react-helmet="true" name="twitter:title" content="Provision an Ubuntu-based EC2 instance with CDK"/><meta data-react-helmet="true" name="twitter:description" content="You are using CDK and you need to provision an EC2 instance. What if you prefer to use Ubuntu over Amazon Linux? In this article, we will…"/><meta data-react-helmet="true" name="twitter:image" content="https://loige.co/static/a58ef69c9e52605c216503b33419d7c5/provision-ubuntu-ec2-with-cdk-tw.png"/><script data-react-helmet="true" type="application/ld+json">[{"@context":"http://schema.org","@type":"WebSite","url":"https://loige.co/provision-ubuntu-ec2-with-cdk/","name":"Provision an Ubuntu-based EC2 instance with CDK","alternateName":"Luciano Mammino \"Loige\" - FullStack & Cloud developer, fighter, butterfly maker!"},{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://loige.co/provision-ubuntu-ec2-with-cdk/","name":"Provision an Ubuntu-based EC2 instance with CDK","image":"https://loige.co/static/f2dd79f9a3e4efc02149a5514432e86c/provision-ubuntu-ec2-with-cdk-fb.png"}}]},{"@context":"http://schema.org","@type":"BlogPosting","url":"https://loige.co/provision-ubuntu-ec2-with-cdk/","name":"Provision an Ubuntu-based EC2 instance with CDK","alternateName":"Luciano Mammino \"Loige\" - FullStack & Cloud developer, fighter, butterfly maker!","headline":"Provision an Ubuntu-based EC2 instance with CDK","image":{"@type":"ImageObject","url":"https://loige.co/static/f2dd79f9a3e4efc02149a5514432e86c/provision-ubuntu-ec2-with-cdk-fb.png"},"description":"You are using CDK and you need to provision an EC2 instance. What if you prefer to use Ubuntu over Amazon Linux? In this article, we will…","author":{"@type":"Person","name":"Luciano Mammino"},"publisher":{"@type":"Organization","url":"https://loige.co/","name":"Luciano Mammino","logo":{"@context":"http://schema.org","itemtype":"https://schema.org/ImageObject","url":"https://loige.co/favicon.ico"}},"mainEntityOfPage":{"@type":"WebSite","@id":"https://loige.co/"},"datePublished":"2021-08-06T13:05:00.000Z"}]</script><link as="script" rel="preload" href="/webpack-runtime-0019acd3e3ba19e6ba77.js"/><link as="script" rel="preload" href="/framework-9d9eff57288a5d76d992.js"/><link as="script" rel="preload" href="/app-514e309b4e51a67a0ada.js"/><link as="script" rel="preload" href="/ab670281d767243777119348a2b810446e7309bb-19b089964506eaf24367.js"/><link as="script" rel="preload" href="/850935577dc6138b95e5bc3f6f1d9b06bd36398e-bd6be05cfb6becde2e63.js"/><link as="script" rel="preload" href="/4d6423837748823c19bdd3076c1db680baba727b-30a9131768be883bb7a1.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-f8a40d902eea460a8b7d.js"/><link as="fetch" rel="preload" href="/page-data/provision-ubuntu-ec2-with-cdk/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><style data-emotion="css-global xqze0f">*{box-sizing:border-box;margin:0;padding:0;}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-style:normal;font-weight:400;fill:currentColor;}@media (min-width: 780px){body{margin:60px 0 0 0;}}code,pre{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace;font-weight:300;}.content a{-webkit-text-decoration:none;text-decoration:none;}blockquote .gatsby-highlight{margin:1.5em 0 1.5em 0;padding:0.5em;}.gatsby-highlight{font-size:15px;line-height:1.7;background:#282c34;color:#ffffff;border-radius:10px;overflow:auto;tab-size:1.5em;margin:1.5em -1em 1.5em 0;padding:1em;}@media (min-width: 780px){.gatsby-highlight{margin-left:-2em;padding-left:2em;padding-right:2em;font-size:16px;}}.gatsby-highlight .token.attr-name{color:#c5a5c5;}.gatsby-highlight .token.comment,.gatsby-highlight .token.block-comment,.gatsby-highlight .token.prolog,.gatsby-highlight .token.doctype,.gatsby-highlight .token.cdata{color:#999999;}.gatsby-highlight .token.property,.gatsby-highlight .token.number,.gatsby-highlight .token.function-name,.gatsby-highlight .token.constant,.gatsby-highlight .token.symbol,.gatsby-highlight .token.deleted{color:#5a9bcf;}.gatsby-highlight .token.boolean{color:#ff8b50;}.gatsby-highlight .token.tag{color:#fc929e;}.gatsby-highlight .token.string{color:#8dc891;}.gatsby-highlight .token.punctuation{color:#5FB3B3;}.gatsby-highlight .token.selector,.gatsby-highlight .token.char,.gatsby-highlight .token.builtin,.gatsby-highlight .token.inserted{color:#D8DEE9;}.gatsby-highlight .token.function{color:#79b6f2;}.gatsby-highlight .token.operator,.gatsby-highlight .token.entity,.gatsby-highlight .token.url,.gatsby-highlight .token.variable{color:#d7deea;}.gatsby-highlight .token.attr-value{color:#8dc891;}.gatsby-highlight .token.keyword{color:#c5a5c5;}.gatsby-highlight .token.atrule,.gatsby-highlight .token.class-name{color:#FAC863;}.gatsby-highlight .token.important{font-weight:400;}.gatsby-highlight .token.bold{font-weight:700;}.gatsby-highlight .token.italic{font-style:italic;}.gatsby-highlight .token.entity{cursor:help;}.gatsby-highlight>pre{height:auto!important;margin:1rem;white-space:pre-wrap;word-break:break-word;}.gatsby-highlight+.gatsby-highlight{margin-top:20px,;}.gatsby-highlight-code-line{background-color:#14161a;display:block;margin:-0.125rem calc(-1rem - 15px);padding:0.125rem calc(1rem + 15px);}</style><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css 1l9yz54 1q6mh99 m735s1 1q6mh99 m735s1 1q6mh99 m735s1 1q6mh99 m735s1 1q6mh99 m735s1">.css-1l9yz54{display:none;}@media (min-width: 540px){.css-1l9yz54{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-1q6mh99{color:#fff;-webkit-text-decoration:none;text-decoration:none;text-align:center;padding:5px 4px;white-space:nowrap;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:background 150ms;transition:background 150ms;border-radius:0.5em;}.css-1q6mh99:hover{background:rgba(255, 255, 255, 0.2);}@media (min-width: 780px){.css-1q6mh99{padding:5px 10px;}}.css-m735s1{width:16px;height:16px;color:#fff;fill:currentColor;}@media (min-width: 540px){.css-m735s1{width:24px;height:24px;}}@media (min-width: 1180px){.css-m735s1{margin:0 0 0 0;}}</style><style data-emotion="css z5ptlm">.css-z5ptlm{background-color:rgba(32, 35, 42, 0.95);color:#ffffff;display:block;position:auto;z-index:2000;width:100%;top:0;left:0;}@media (min-width: 780px){.css-z5ptlm{position:fixed;}}</style><header class="css-z5ptlm ejhzk945"><style data-emotion="css otpe3t">.css-otpe3t{padding-left:4px;padding-right:4px;margin-left:auto;margin-right:auto;max-width:1260px;}@media (min-width: 780px){.css-otpe3t{width:90%;padding-left:20px;padding-right:20px;}}</style><div class="css-otpe3t ejhzk944"><style data-emotion="css z95nvu">.css-z95nvu{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:60px;}</style><div class="css-z95nvu ejhzk943"><style data-emotion="css s0y9ho x9illq 192ssef">.css-s0y9ho{color:#46c9e5;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-right:10px;height:100%;-webkit-text-decoration:none;text-decoration:none;-webkit-flex-direction:center;-ms-flex-direction:center;flex-direction:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:none;}@media (min-width: 600px){.css-s0y9ho{width:calc(100% / 6);}}@media (min-width: 540px){.css-s0y9ho{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-x9illq{display:inline-block;vertical-align:top;}.css-192ssef{margin-left:10px;font-weight:bold;font-size:20px;line-height:20px;}</style><a class="css-s0y9ho" href="/"><img class="css-x9illq" height="60px" src="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjExNjMuMTI2IiB2aWV3Qm94PSIwIDAgMTI4NS41NjMgMTE2My4xMjYiIHdpZHRoPSIxMjg1LjU2MyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGNsaXBQYXRoIGlkPSJhIj48cGF0aCBkPSJtMCAwaDEyODUuNTYzdjExNjMuMTI2aC0xMjg1LjU2M3oiLz48L2NsaXBQYXRoPjxnIGNsaXAtcGF0aD0idXJsKCNhKSI+PHBhdGggZD0ibTExNjMuMTMxIDU1MC45NTV2NjEuMjE2aC02MS4yMTd2MjQ0Ljg2OWg2MS4yMTcgNjEuMjE2di0zMDYuMDg1eiIgZmlsbD0iIzc0NGUyNiIvPjxwYXRoIGQ9Im01NTAuOTU1IDc5NS44MjRoLTEyMi40Mzd2NjEuMjE2aC02MS4yMTZ2MTIyLjQzN2gxMjIuNDM3di02MS4yMTZoNjEuMjE2eiIgZmlsbD0iIzc0NGUyNiIvPjxwYXRoIGQ9Im05MTguMjYxIDYxMi4xNzFoLTYxLjIxNnYtNjEuMjE2aDYxLjIxNnptNjEuMjE3IDBoLTYxLjIxN3Y2MS4yMTZoNjEuMjE3em0xMjIuNDMyIDYxLjIxNnYxODMuNjUzaC0xMjIuNDMyLTEyMi40Mzd2NjEuMjE3aC0xMjIuNDMzLTE4My42NTN2LTE4My42NDloMTIyLjQzN3YtMTIyLjQzN2g2MS4yMTZ2NjEuMjE2aDE4My42NTN2NjEuMjIxaDYxLjIxN3YtNjEuMjIxem0tMzA2LjA4NiA2MS4yMjFoLTYxLjIxNnY2MS4yMTZoNjEuMjE2em0tMTgzLjY0OC0xMjIuNDM3aDYxLjIxNnYtNjEuMjE2aC02MS4yMTZ6IiBmaWxsPSIjNGVjMmM4Ii8+PHBhdGggZD0ibTkxOC4yNjEgMTIyLjQzMnYtNjEuMjE2aC00MjguNTE4djYxLjIxNmgtNjEuMjIxdjM2Ny4zMDJoMTIyLjQzN3YtNjEuMjE2aC02MS4yMTZ2LTEyMi40MzNoNjEuMjE2djEyMi40MzNoNjEuMjE3di0xMjIuNDMzaDEyMi40MzJ2LTEyMi40MzZoMTgzLjY1M3Y2MS4yMmg2MS4yMTd2LTEyMi40Mzd6IiBmaWxsPSIjNzQ0ZTI2Ii8+PHBhdGggZD0ibTk3OS40NzggMTIyLjQzNmg2MS4yMTZ2NjEuMjE3aC02MS4yMTZ6IiBmaWxsPSIjMmEyYTJhIi8+PHBhdGggZD0ibTYxMi4xNzEgNjEyLjE3MWg2MS4yMTd2MTIyLjQzN2gtMTgzLjY0OXYtNjEuMjE3aC0xMjIuNDM3di0xMjIuNDM2aDI0NC44Njl6bTM2Ny4zMDcgNjEuMjJoLTYxLjIxN3Y2MS4yMTdoNjEuMjE3em0tMjQ0Ljg3NCAxMjIuNDMzaDYxLjIxNnYtNjEuMjE2aC02MS4yMTZ6bTI0NC44NzQtNjEyLjE3MXY2MS4yMTZoNjEuMjE2djEyMi40MzNoLTYxLjIxNnYxODMuNjUzaC02MS4yMjF2NjEuMjE2aDEyMi40Mzd2LTYxLjIxNmg2MS4yMTZ2LTYxLjIxN2g2MS4yMTZ2LTYxLjIyLTEyMi40MzMtMTIyLjQzMnptLTEyMi40MzcgMzY3LjMwMmgtMTgzLjY1M3Y2MS4yMTZoNjEuMjE2djYxLjIyaDE4My42NTN2LTYxLjIyaC02MS4yMTZ6IiBmaWxsPSIjZmJkODAwIi8+PHBhdGggZD0ibTEyMjQuMzQ3IDQ4OS43MzR2LTQ4OS43MzRoLTYxLjIxNi03MzQuNjA5djYxLjIxNmgtNjEuMjE2djQyOC41MThoLTE4My42NTN2NjEuMjIxaC02MS4yMnYxODMuNjQ5aDI0NC44NzN2NjEuMjJoLTEyMi40Mzd2NjEuMjE2aC02MS4yMTZ2NjEuMjE3aDYxLjIxNnY2MS4yMmg2MS4yMTd2NjEuMjE2aDEyMi40MzZ2NjEuMjE3aDYxLjIxN3YtNjEuMjE3aDYxLjIxNnYtNjEuMjE2aDQyOC41MjN2LTYxLjIyaDMwNi4wODV2LTQyOC41MjN6bTAgMzY3LjMwNmgtMzY3LjMwNnY2MS4yMTdoLTM2Ny4zMDJ2NjEuMjJoLTEyMi40MzN2LTEyMi40MzdoNjEuMjE2di02MS4yMTZoMTIyLjQzM3YtNjEuMjJoLTYxLjIxNnYtNjEuMjE3aC0zMDYuMDg2di02MS4yMTZoNjEuMjE2di02MS4yMTZoMTIyLjQzNyAxODMuNjQ5di02MS4yMjFoLTEyMi40MzN2LTE4My42NDktMTgzLjY1M2g2MS4yMTd2LTYxLjIxNmg0MjguNTIydjYxLjIxNmg2MS4yMTd2LTYxLjIxNmgxODMuNjUzdjQyOC41MThoLTYxLjIyMXY2MS4yMjFoLTYxLjIxNnY2MS4yMTZoLTYxLjIxNnY2MS4yMTZoMTIyLjQzMnYtNjEuMjE2aDYxLjIyMXYtNjEuMjE2aDYxLjIxNnoiIGZpbGw9IiMyYTJhMmEiLz48cGF0aCBkPSJtODU3LjA0MSAzMDYuMDg1aC02MS4yMTd2LTYxLjIxNmg2MS4yMTd6bS02NzMuMzg4IDYxMi4xNzJoLTYxLjIxNnY2MS4yMTZoNjEuMjE2em0xODMuNjUzIDI0NC44NjloNjEuMjE2di02MS4yMTZoLTYxLjIxNnptLTE4My42NTMtNjEuMjE2aDYxLjIxNnYtNjEuMjE3aC02MS4yMTZ6bS0xODMuNjUzIDBoNjEuMjE2di02MS4yMTdoLTYxLjIxNnptOTc5LjQ3OC02NzMuMzkydi02MS4yMTZoLTE4My42NTR2NjEuMjE2aC02MS4yMTZ2MTIyLjQzN2gxMjIuNDMzIDEyMi40Mzd2LTYxLjIyMWgtMTIyLjQzN3YtNjEuMjE2eiIgZmlsbD0iIzJhMmEyYSIvPjxnIGZpbGw9IiNmZmYiPjxwYXRoIGQ9Im03OTUuODI0IDI0NC44NjloMTIyLjQzNnYtNjEuMjE2aC0xMjIuNDM2LTYxLjIxNnYxMjIuNDMyaDYxLjIxNnptNjEuMjE3IDYxLjIxNmgtNjEuMjE3djYxLjIxN2gyNDQuODcydi02MS4yMTdoLS4wMDJ2LTYxLjIxNmgtMTgzLjY1M3ptLTMwNi4wODYgMTIyLjQzM2gxODMuNjUzdjEyMi40MzdoLTE4My42NTN6bS02MS4yMTYtMTIyLjQzM2g2MS4yMTZ2MTIyLjQzM2gtNjEuMjE2em0xMjIuNDM3IDBoMTgzLjY0OHYxMjIuNDMzaC0xODMuNjQ4em0yNDQuODY1IDEyMi40MzNoMTIyLjQzN3Y2MS4yMTZoLTEyMi40Mzd6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48cGF0aCBkPSJtMjQ0Ljg2OSA2NzMuMzkxaDEyMi40MzN2LTEyMi40MzZoLTEyMi40MzN2NjEuMjE4aC02MS4yMTZ2NjEuMjE4eiIvPjxwYXRoIGQ9Im0xMTYzLjEyNiAxMjIuNDM2aC4wMDV2LTYxLjIyaC0xODMuNjUzdjYxLjIyaDYxLjIxOHY2MS4yMTdoMTIyLjQzeiIvPjwvZz48L2c+PC9zdmc+" alt="Loige"/><span class="css-192ssef">Loige</span></a><style data-emotion="css 1ld37qd">.css-1ld37qd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;height:100%;width:60%;}@media (min-width: 1180px){.css-1ld37qd{width:60%;}}</style><nav class="css-1ld37qd ejhzk942"><style data-emotion="css brnyfx 1f3jrqb">.css-brnyfx{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#ffffff;-webkit-transition:color 0.2s ease-out;transition:color 0.2s ease-out;padding-left:15px;padding-right:15px;font-weight:300;-webkit-text-decoration:none;text-decoration:none;}@media (min-width: 1280px){.css-brnyfx{padding-left:20px;padding-right:20px;font-size:18px;}}.css-1f3jrqb{color:#46c9e5;position:relative;}</style><a class="css-brnyfx css-1f3jrqb" href="/"><style data-emotion="css 1eand3o">.css-1eand3o{position:absolute;bottom:-1px;height:4px;left:0px;right:0px;z-index:1;background:#46c9e5;}</style><span class="css-1eand3o e5yudoc0"></span>Blog</a><a class="css-brnyfx" href="/speaking">Speaking</a><a class="css-brnyfx" href="/about">About</a></nav><style data-emotion="css 150b3u1">.css-150b3u1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;height:100%;width:40%;}@media (min-width: 1180px){{width:40%;}}</style><div class="css-150b3u1 ejhzk941"><a rel="nofollow" class="css-1q6mh99" href="https://twitter.com/loige"><svg aria-label="Twitter" viewBox="0 0 24 24" width="1em" height="1em" class="css-m735s1" alt="Luciano&#x27;s Twitter profile"><path fill="currentColor" d="M23.954 4.569a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.691 8.094 4.066 6.13 1.64 3.161a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.061a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.937 4.937 0 0 0 4.604 3.417 9.868 9.868 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63a9.936 9.936 0 0 0 2.46-2.548l-.047-.02z"></path></svg></a><a rel="nofollow" class="css-1q6mh99" href="https://twitch.tv/loige"><svg aria-label="Twitch" viewBox="0 0 24 24" width="1em" height="1em" class="css-m735s1" alt="Luciano&#x27;s Twitch profile"><path fill="currentColor" d="M.975 4.175v16.694h5.749V24h3.139l3.134-3.132h4.705l6.274-6.258V0H2.542zm3.658-2.09h17.252v11.479l-3.66 3.652h-5.751L9.34 20.343v-3.127H4.633z"></path><path fill="currentColor" d="M10.385 6.262h2.09v6.26h-2.09zM16.133 6.262h2.091v6.26h-2.091z"></path></svg></a><a rel="nofollow" class="css-1q6mh99" href="https://www.youtube.com/channel/UCL0w2IAjTBx3NNka-l7InPw"><svg aria-label="Youtube" viewBox="0 0 24 24" width="1em" height="1em" class="css-m735s1" alt="Luciano&#x27;s YouTube profile"><path fill="currentColor" d="M23.469 5.929l.03.196a3.043 3.043 0 0 0-2.068-2.112l-.021-.005c-1.871-.508-9.4-.508-9.4-.508s-7.51-.01-9.4.508A3.044 3.044 0 0 0 .527 6.104l-.005.021c-.699 3.651-.704 8.038.031 11.947l-.031-.198a3.043 3.043 0 0 0 2.068 2.112l.021.005c1.869.509 9.4.509 9.4.509s7.509 0 9.4-.509a3.043 3.043 0 0 0 2.084-2.096l.005-.021c.318-1.698.5-3.652.5-5.648l-.001-.221.001-.23c0-1.997-.182-3.951-.531-5.846zM9.608 15.651V8.358l6.266 3.652z"></path></svg></a><a rel="nofollow" class="css-1q6mh99" href="https://www.linkedin.com/in/lucianomammino/"><svg aria-label="LinkedIn" viewBox="0 0 24 24" width="1em" height="1em" class="css-m735s1" alt="Luciano&#x27;s LinkedIn profile"><path fill="currentColor" d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a rel="nofollow" class="css-1q6mh99" href="https://github.com/lmammino"><svg aria-label="GitHub" viewBox="0 0 24 24" width="1em" height="1em" class="css-m735s1" alt="Luciano&#x27;s GitHub profile"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div></div></div><style data-emotion="css 1cfofik">.css-1cfofik{height:2px;display:block;transform-origin:left center 0px;-webkit-transform:scaleX(1);-moz-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);z-index:50;-webkit-transition:-webkit-transform 400ms ease 100ms;transition:transform 400ms ease 100ms;background:linear-gradient(90deg, #46c9e5, #d26ac2);}</style><span class="css-1cfofik ejhzk940"></span></header><style data-emotion="css gvup9u">.css-gvup9u{background-color:#46c9e5;background-repeat:no-repeat;-webkit-background-position:center;background-position:center;-webkit-background-size:cover;background-size:cover;width:100%;min-height:300px;height:50vh;display:table;}.css-gvup9u.small{max-height:300px;}.css-gvup9u.tiledBg{-webkit-background-size:auto;background-size:auto;background-repeat:repeat;}.css-gvup9u.bottomRightBg{-webkit-background-position:bottom right;background-position:bottom right;}.css-gvup9u.gradientOverlay{position:relative;z-index:-2;}.css-gvup9u.gradientOverlay:before{content:'';position:absolute;top:0;right:0;bottom:0;left:0;background-image:linear-gradient(to bottom right, #46c9e5, #d26ac2);opacity:0.6;z-index:-1;}@media (min-width: 780px){.css-gvup9u{height:70vh;}}</style><div class="textOverlay css-gvup9u ea1ziiz1" style="background-image:url(/static/9e5e2056046a128d577fe018946df76b/provision-ubuntu-ec2-with-cdk-luciano-mammino-loige.jpg)"><style data-emotion="css 1vmuur7">.css-1vmuur7{display:table-cell;vertical-align:middle;text-align:center;font-weight:700;color:#fff;padding:0 2em;color:white;text-shadow:1px 3px 0 #000,-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;}@media (min-width: 780px){.css-1vmuur7{font-size:1.2em;}}.css-1vmuur7 h1{font-size:2em;line-height:1.6em;}.css-1vmuur7 h2{font-size:1.5em;margin:0.5em 0 0 0;line-height:1.6em;}.css-1vmuur7.textOverlay>*>span{background:#000000c4;display:inline;padding:0.2em;-webkit-box-decoration-break:clone;box-decoration-break:clone;-webkit-box-decoration-break:clone;}</style><div class="textOverlay css-1vmuur7 ea1ziiz0"><h1><span>Provision an Ubuntu-based EC2 instance with CDK</span></h1></div></div><style data-emotion="css 48rqd6">.css-48rqd6{min-height:100vh;margin:0 auto;padding-left:20px;padding-right:20px;max-width:1260px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media (min-width: 780px){.css-48rqd6{width:90%;}}</style><div class="css-48rqd6 e1kc7zwr4"><style data-emotion="css y3klfd">.css-y3klfd{-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><section class="css-y3klfd e1kc7zwr3"><style data-emotion="css 3igp7s">.css-3igp7s{-webkit-flex:1;-ms-flex:1;flex:1;}@media (min-width: 780px){.css-3igp7s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}</style><div class="css-3igp7s e1kc7zwr2"><style data-emotion="css nmfn">.css-nmfn{-webkit-flex:3;-ms-flex:3;flex:3;width:100%;}</style><main class="css-nmfn e1kc7zwr1"><style data-emotion="css t2ycg8">.css-t2ycg8{margin:2em 0;line-height:25px;padding:0 1em;}.css-t2ycg8 a{-webkit-text-decoration:none;text-decoration:none;color:inherit;}.css-t2ycg8 a:hover{-webkit-text-decoration:underline;text-decoration:underline;}@media (min-width: 780px){.css-t2ycg8{padding:0 2em;}}</style><div class="css-t2ycg8 ep8980s1"><style data-emotion="css 0 rm23k1">.css-rm23k1{margin:0 0.25em 0 0;}</style><style data-emotion="css 1o5dns8">.css-1o5dns8{vertical-align:middle;font-size:inherit;margin:0 0.5em;display:inline-block;}.css-1o5dns8 span{vertical-align:text-bottom;}</style><span style="margin-left:0" class="css-1o5dns8 e1r90wi10"><svg aria-hidden="true" data-prefix="far" data-icon="calendar-alt" class="css-rm23k1" viewBox="0 0 448 512" width="1em" height="1em"><path fill="currentColor" d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"></path></svg><span>August 06, 2021</span></span><style data-emotion="css j1wil6">.css-j1wil6{vertical-align:middle;margin:0 0.5em 0 1em;display:inline-block;}.css-j1wil6 a{color:inherit;font-weight:bold;-webkit-text-decoration:none;text-decoration:none;vertical-align:text-bottom;}</style><span class="css-j1wil6 ex82wp61"><svg aria-hidden="true" data-prefix="fas" data-icon="tags" class="css-rm23k1" viewBox="0 0 640 512" width="1em" height="1em"><path fill="currentColor" d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"></path></svg><a href="/tag/aws">#<!-- -->aws</a><style data-emotion="css 15kp1k9">.css-15kp1k9{vertical-align:text-bottom;}</style><span class="css-15kp1k9 ex82wp60">, </span><a href="/tag/cdk">#<!-- -->cdk</a><span class="css-15kp1k9 ex82wp60">, </span><a href="/tag/javascript">#<!-- -->javascript</a><span class="css-15kp1k9 ex82wp60">, </span><a href="/tag/typescript">#<!-- -->typescript</a><span class="css-15kp1k9 ex82wp60">, </span><a href="/tag/nginx">#<!-- -->nginx</a></span><a href="#comments" title="Read comments"><svg aria-hidden="true" data-prefix="fas" data-icon="comments" class="svg-inline--fa fa-comments fa-w-18" viewBox="0 0 576 512" width="1em" height="1em" style="margin:0 .25em 0 1em"><path fill="currentColor" d="M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"></path></svg><span class="disqus-comment-count" data-disqus-identifier="provision-ubuntu-ec2-with-cdk" data-disqus-url="https://loige.co/provision-ubuntu-ec2-with-cdk">comments</span></a><p>— Published by<!-- --> <style data-emotion="css 1u9uk5p">.css-1u9uk5p{background:transparent!important;white-space:nowrap!important;color:#000!important;}.css-1u9uk5p:hover{-webkit-text-decoration:underline!important;text-decoration:underline!important;}</style><a href="https://twitter.com/loige" rel="nofollow noopener noreferrer" target="_blank" class="css-1u9uk5p e1ondplw2"><style data-emotion="css 1gejjbo">.css-1gejjbo{border-radius:50%;width:2em;height:2em;vertical-align:middle;display:inline-block;margin:0 .5em 0 0;overflow:hidden;}</style><img alt="Luciano Mammino&#x27;s profile picture" src="https://unavatar.now.sh/github/lmammino" class="css-1gejjbo e1ondplw1"/>Luciano Mammino</a></p></div><style data-emotion="css 1eveted">.css-1eveted{margin:2em 0;line-height:25px;padding:0 1em;}.css-1eveted code{white-space:pre-wrap;word-break:break-word;}@media (min-width: 780px){.css-1eveted{padding:0 2em;}}.css-1eveted a{background-color:rgba(187, 239, 253, 0.3);border-bottom:1px solid rgba(0, 0, 0, 0.2);-webkit-text-decoration:none;text-decoration:none;color:inherit;}.css-1eveted a:hover{background-color:#bbeffd;border-bottom-color:#1a1a1a;}.css-1eveted a.anchor,.css-1eveted a.gatsby-resp-image-link{background-color:transparent;border:none;}.css-1eveted a.anchor.before{position:absolute;top:64px;left:-1em;}.css-1eveted>p:first-of-type{font-size:18px;font-weight:300;color:#6d6d6d;}.css-1eveted>p:first-of-type a,.css-1eveted>p:first-of-type strong{font-weight:400;}@media (min-width: 780px){.css-1eveted>p:first-of-type{font-size:24px;}}.css-1eveted p{margin:1em 0 0 0;font-size:16px;line-height:1.7;max-width:42em;}@media (min-width: 780px){.css-1eveted p{font-size:17px;line-height:1.7;}}.css-1eveted h2,.css-1eveted h3,.css-1eveted h4,.css-1eveted h5{margin:2em 0 0 0;}.css-1eveted p>code,.css-1eveted li>code{background:rgba(255, 229, 100, 0.2);color:inherit;display:inline-block;padding:0 0.3em;}.css-1eveted p>code,.css-1eveted li>code,.css-1eveted p>a>code,.css-1eveted li>a>code{padding:0 3px;font-size:inherit;word-break:break-word;}.css-1eveted h2{border-top:1px solid #ececec;margin-top:2em;padding-top:2em;line-height:1.2;font-size:20px;}.css-1eveted h2:first-of-type{border-top:0;padding-top:0;}@media (min-width: 780px){.css-1eveted h2{font-size:35px;}}.css-1eveted hr+h2{border-top:0;margin-top:0;}.css-1eveted h3{padding-top:45px;font-size:18px;}@media (min-width: 780px){.css-1eveted h3{font-size:25px;line-height:1.3;}}.css-1eveted h2+h3,.css-1eveted h2+h3:first-of-type{padding-top:30px;}.css-1eveted h4{font-size:20px;color:#6d6d6d;line-height:1.3;margin-top:50px;font-weight:400;}.css-1eveted h4+p{margin-top:20px;}.css-1eveted ol,.css-1eveted ul{margin-top:20px;font-size:16px;padding-left:2em;}.css-1eveted ol p,.css-1eveted ul p,.css-1eveted ol p:first-of-type,.css-1eveted ul p:first-of-type{font-size:16px;margin-top:0;line-height:1.2;}.css-1eveted ol li,.css-1eveted ul li{margin-top:10px;}.css-1eveted img{max-width:100%;}.css-1eveted ol{list-style:decimal;}.css-1eveted ul{list-style:disc;}.css-1eveted blockquote{background-color:rgba(255, 229, 100, 0.3);border-left-color:#ffe564;border-left-width:9px;border-left-style:solid;padding:20px 45px 20px 26px;margin:1em 0 2em -1em;}@media (min-width: 780px){.css-1eveted blockquote{margin-left:-2em;}}.css-1eveted blockquote p{margin-top:15px;}.css-1eveted blockquote p:first-of-type{font-weight:700;margin-top:0;}.css-1eveted blockquote p:nth-of-type(2){margin-top:0;}.css-1eveted table{margin:1em auto;border-spacing:0;border-collapse:collapse;width:100%;}@media (min-width: 780px){.css-1eveted table{width:80%;}}.css-1eveted table td,.css-1eveted table th{border:1px solid #ccc;margin:0;padding:0.4em;}.css-1eveted table+legend{border-left:3px solid #ccc;font-size:small;font-style:italic;width:100%;margin:1em auto;padding:0 0 0 1em;}@media (min-width: 780px){.css-1eveted table+legend{width:80%;}}</style><article class="css-1eveted e1lcgljk0"><p>You are using CDK and you need to provision an EC2 instance. What if you prefer to use <strong>Ubuntu</strong> over <strong>Amazon Linux</strong>? In this article, we will see exactly how to do that, and, hopefully, we will learn a bunch of interesting things in the process!</p>
<p>I have to be honest, I am more on the Ubuntu camp than I am in the Amazon Linux one… It’s a subjective preference. I find myself more comfortable with <code>apt</code>, <code>snap</code>, <code>systemd</code> and other Ubuntu nuances than I am with <code>yum</code> and other things in Amazon Linux. Plus, I find easier to find resources about how to do all sort of things with Ubuntu.</p>
<p>So, the story goes that I was playing with CDK and I was trying to deploy a simple Node.js application to an EC2 instance. All the CDK examples I could find were using Amazon Linux, but I thought it wouldn’t be too complicated to switch to Ubuntu instead. I already had a Systemd service definition written for my app and a script to install all dependencies using <code>apt</code>.</p>
<p>How hard could it be to use Ubuntu? It turns out there are some dark corners and the necessary documentation is scattered around the web. I will try to document my finding and provide a complete example in this article. We will also see how to install the <code>aws</code> CLI and other necessary AWS utilities in our Ubuntu-based virtual machine. Once you do all these things, you should have a Ubuntu image that is pretty much on par with the Amazon Linux one.</p>
<h2 id="what-is-cdk" style="position:relative;"><a href="#what-is-cdk" aria-label="what is cdk permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What is CDK</h2>
<p>Ok, if you know CDK already, you can just skip this section. If you don’t, how on the world wide web did you end up on this page? 😅</p>
<p><a href="https://aws.amazon.com/cdk/">CDK</a> stands for <strong>Cloud Development Kit</strong> and it’s a relatively new tool from Amazon to write infrastructure as code (<em>IaC</em>).</p>
<p>CDK allows you to define all your cloud infrastructure programmatically so you can keep it versioned and you can have a reproducible deployment process. If you use CDK you won’t have to go in the AWS web console and click around to provision resources, you’ll write code and use command-line tools (or CI/CD pipelines) to do that for you.</p>
<p>If you have used tools like <strong>Terraform</strong> or <strong>CloudFormation</strong> already, CDK addresses the same type of problems. What’s different with CDK is that you don’t have to write a ton of JSON, Yaml or learn a new markup language such as <a href="https://github.com/hashicorp/hcl">HCL</a>.</p>
<p>In fact, with CDK you can use your favorite programming language (TypeScript, Python, Java and C# are supported right now) and you can define the resources in your cloud infrastructure by importing classes and instantiating objects.</p>
<p>Just to give you an example, this is how you can create a new SSM parameter using CDK (TypeScript):</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ssm <span class="token keyword">from</span> <span class="token string">'@aws-cdk/aws-ssm'</span>

<span class="token keyword">new</span> <span class="token class-name">ssm</span><span class="token punctuation">.</span><span class="token function">StringParameter</span><span class="token punctuation">(</span>stack<span class="token punctuation">,</span> <span class="token string">'Parameter'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  allowedPattern<span class="token operator">:</span> <span class="token string">'.*'</span><span class="token punctuation">,</span>
  description<span class="token operator">:</span> <span class="token string">'The value Foo'</span><span class="token punctuation">,</span>
  parameterName<span class="token operator">:</span> <span class="token string">'FooParameter'</span><span class="token punctuation">,</span>
  stringValue<span class="token operator">:</span> <span class="token string">'Foo'</span><span class="token punctuation">,</span>
  tier<span class="token operator">:</span> ssm<span class="token punctuation">.</span>ParameterTier<span class="token punctuation">.</span><span class="token constant">ADVANCED</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>You can see already that the main advantage of CDK is that you’ll be able to use your favorite language, your favorite code editor or IDE and get other nice things like syntax highligting, type checking, auto-completion, etc.</p>
<p>I have found that there’s much less guesswork or “writing configuration by trial and error” when using CDK as opposed to writing plain CloudFormation configuration or using Terraform.</p>
<p>It’s worth knowing that CDK is not a standalone tool, but it’s an abstraction built on top of CloudFormation. So when you <em>synthesise</em> (which is how you say <em>compile</em> in CDK lingo) a CDK stack, you actually get a CloudFormation stack. When you run <code>cdk deploy</code> you are actually deploying that stack with CloudFormation. This way, you still get all the benefits of CloudFormation, but you also get a nicer way to write down your infrastructure as code.</p>
<p>If you want to know how to get started with CDK check out the official guide <a href="https://docs.aws.amazon.com/cdk/latest/guide/getting_started.html">Getting started with the AWS CDK</a>.</p>
<h2 id="defining-an-ec2-resource-with-cdk" style="position:relative;"><a href="#defining-an-ec2-resource-with-cdk" aria-label="defining an ec2 resource with cdk permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Defining An EC2 resource with CDK</h2>
<p>From here, I am assuming you have already installed CDK and generated a project with <code>cdk init</code>.</p>
<p>If you want to have a look at the final version of the code we will be discussing here, you can check out the <a href="https://github.com/lmammino/cdk-ubuntu-ec2">project repository on GitHub</a>.</p>
<p>To provision an EC2 instance with CDK using TypeScript we need to install the package <code>@aws-cdk/aws-ec2</code>:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> i --save @aws-cdk/aws-ec2</code></pre></div>
<p>Then we can define the instance in a Stack with the following code (intentionally incomplete):</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> cdk <span class="token keyword">from</span> <span class="token string">'@aws-cdk/core'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ec2 <span class="token keyword">from</span> <span class="token string">'@aws-cdk/aws-ec2'</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MyAppStack</span> <span class="token keyword">extends</span> <span class="token class-name">cdk</span><span class="token punctuation">.</span>Stack <span class="token punctuation">{</span>
  <span class="token keyword">const</span> defaultVpc <span class="token operator">=</span> ec2<span class="token punctuation">.</span>Vpc<span class="token punctuation">.</span><span class="token function">fromLookup</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'VPC'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    isDefault<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> myVm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ec2</span><span class="token punctuation">.</span><span class="token function">Instance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'myVm'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// the type of instance to deploy (e.g. a 't2.micro')</span>
    instanceType<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ec2</span><span class="token punctuation">.</span><span class="token function">InstanceType</span><span class="token punctuation">(</span><span class="token string">'t2.micro'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// the id of the image to use for the instance</span>
    machineImage<span class="token operator">:</span> someAmiId<span class="token punctuation">,</span>
    <span class="token comment">// A reference to the object representing the VPC</span>
    <span class="token comment">// you want to deploy the instance into</span>
    vpc<span class="token operator">:</span> defaultVpc
    <span class="token comment">// ... more configuration</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>As you can see that there are 3 mandatory pieces of information we need to provide:</p>
<ul>
<li>The <a href="https://aws.amazon.com/ec2/instance-types/">type of EC2 instance</a> we want to run (i.e. <code>t2.micro</code>)</li>
<li>The id of the machine image (more on this in the next section)</li>
<li>The id of the VPC (Virtual Private Cloud) where you want to deploy your instance. For example, in the snippet above, we are using the default VPC in your AWS account.</li>
</ul>
<p>You can also specify a ton of other optional configuration options (Security Groups, a role for IAM permissions, volumes, etc). For a full list of supported options you can check out <a href="https://docs.aws.amazon.com/cdk/api/latest/docs/@aws-cdk_aws-ec2.Instance.html">the official documentation for the CDK EC2 Instance construct</a>.</p>
<p>Ok, now how do we specify that we want to use an Ubuntu-based image? Let’s talk about AMIs!</p>
<h2 id="ubuntu-amis-and-where-to-find-them" style="position:relative;"><a href="#ubuntu-amis-and-where-to-find-them" aria-label="ubuntu amis and where to find them permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ubuntu AMIs and where to find them</h2>
<p>When provisioning EC2 instances on AWS you have to provide a virtual machine image (an <em>AMI</em> in AWS lingo). You can build and manage your own custom private images or use one of the many public images for different Linux distributions.</p>
<p>These two approaches have their pros and cons:</p>
<ul>
<li>If you use a public image, you will need to use an init script to provision the machine with all the needed software and configuration. This is a quick and easy way to experiment and iterate over different versions of your virtual machines. On the other hand, this approach might be slow, depending on how much stuff you need to do at every boot.</li>
<li>If you build your own custom images you’ll need to have a pipeline (or some other reproducible approach) to bootstrap a base image, install all your software and create a new image from there. This path adds a bit more complexity but then your images will have everything built in and the bootstrap will probably be much faster.</li>
</ul>
<p>In this article we will go with a public image (Ubuntu) and we will provide the additional bits and pieces by using an init script.</p>
<p>If you are interested in the “build your own image” approach, I’d recommend you to check out <a href="https://aws.amazon.com/image-builder/">EC2 Image Builder</a> or <a href="https://www.packer.io/">Packer</a> (a brilliant tool for building VM images from the same authors of Terraform).</p>
<p>So, back to our main question: <em>how do we find a base image with Ubuntu installed</em>?</p>
<p>There’s an entire website dedicated to finding public AMIs for just Ubuntu: <a href="https://cloud-images.ubuntu.com/locator/ec2/">Ubuntu Amazon EC2 AMI Locator</a>.</p>
<p><a href="https://cloud-images.ubuntu.com/locator/ec2/"><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 65.234375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACP0lEQVQoz3XQOY/UMAAF4PxCCgQ/gJICCVaio6NE9DSIlgL+APXuDovQXLmdO3acy46TOLZzwAbNzHaA9BWveXrS0/D71/GLR8nV0+TqyYNXZ1f/8fIxfPMse/u8+vROG9xDt73mh+98v+H7W37YnMJh021vuu31v9x0+023uxWBpf1e17rnsKwwbTJC06IqGMO0me7vl3X927yu07qO96esTVLCJA48EAd+FPhxGAQ+CH2QI4hRepE9ZIgRLHNcl3nH6DKNmpLSNHTT0G3LtExTPx4D3wsD3/fAhQdcD7gAuK7ruLYdhkFdV5TU8zRpo1KuY9uW6diWbVu+B0hdtaxhTcMa2lDSsoaSmnftpOQoxSgGNXAlhnmeNCmFYeiObV14wIVpkuPs0iSkZpQQSrgQ4zSqUY3LMi6/lBSn5Wka67psKFFyUFKIgUsxKCFGJQfeT0qoeRaRQ799YcDowbH4+rH4/EEyOi+LNqoRgAzj3vPKMKJhiDCmGNdRlAUBqkoG/LRKcHR7F+ysOkbxj594txd9N8+zpqS6+wH8oD0cC9tpgIdSSFJIbCdOUoJzZlpRVUvfQpGdl7WE1cDEOnC+zNOpvN2FUdzrZuUCFgQYoQZlFHgwhTTPW8dJ6pKHRhyasCw6BAklYuD9cj5MbncxROqglw5oPR/Bc9lxkyQlRdFZdkQq4R+j0EiriqOsadt54P18Xpa6jlIodKNyvDaKSoQYyhrfz1LY5HnreVlV8tjNYlCURY8yRqi8LP8BTSKqKfvPYPkAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/7456287b6c7c923a5ac2f624d9134773/8d3d1/ubuntu-amazon-ec2-ami-finder-ui.webp 256w,
/static/7456287b6c7c923a5ac2f624d9134773/354cf/ubuntu-amazon-ec2-ami-finder-ui.webp 512w,
/static/7456287b6c7c923a5ac2f624d9134773/44907/ubuntu-amazon-ec2-ami-finder-ui.webp 1024w"
              sizes="(max-width: 1024px) 100vw, 1024px"
              type="image/webp"
            />
          <source
            srcset="/static/7456287b6c7c923a5ac2f624d9134773/85b06/ubuntu-amazon-ec2-ami-finder-ui.png 256w,
/static/7456287b6c7c923a5ac2f624d9134773/bc282/ubuntu-amazon-ec2-ami-finder-ui.png 512w,
/static/7456287b6c7c923a5ac2f624d9134773/f1720/ubuntu-amazon-ec2-ami-finder-ui.png 1024w"
            sizes="(max-width: 1024px) 100vw, 1024px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/7456287b6c7c923a5ac2f624d9134773/f1720/ubuntu-amazon-ec2-ami-finder-ui.png"
            alt="Ubuntu Amazon EC2 AMI Locator screenshot"
            title="Ubuntu Amazon EC2 AMI Locator screenshot"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
    </span></a></p>
<p>Every image is built for a specific AWS region, processor architecture, and instance type. Every image is identified by a unique ID called <em>AMI ID</em>.</p>
<p>When provisioning a new EC2 instance you need to specify the wanted <em>AMI ID</em> and make sure to select the correct one for the region you are deploying your instance to.</p>
<p>There are a couple of different ways to do that.</p>
<h3 id="machine-ami-map" style="position:relative;"><a href="#machine-ami-map" aria-label="machine ami map permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Machine AMI map</h3>
<p>The simplest way to specify AMI IDs for all the regions we want to support is to use the <a href="https://docs.aws.amazon.com/cdk/api/latest/docs/@aws-cdk_aws-ec2.MachineImage.html#static-genericwbrlinuxamimap-props"><code>ec2.MachineImage.genericLinux()</code></a> helper function.</p>
<p>This function accepts a map of AMI IDs where keys are regions and values are AMI IDs.</p>
<p>Here’s an example:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> machineImage <span class="token operator">=</span> ec2<span class="token punctuation">.</span>MachineImage<span class="token punctuation">.</span><span class="token function">genericLinux</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'eu-west-1'</span><span class="token operator">:</span> <span class="token string">'ami-0298c9e0d2c86b0ed'</span><span class="token punctuation">,</span>
  <span class="token string">'us-east-1'</span><span class="token operator">:</span> <span class="token string">'ami-019212a8baeffb0fa'</span><span class="token punctuation">,</span>
  <span class="token string">'ap-east-1'</span><span class="token operator">:</span> <span class="token string">'ami-04c4bc345657bf245'</span><span class="token punctuation">,</span>
  <span class="token comment">// ... add all the regions you need to support</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Here I have copied some AMI IDs manually from the Ubuntu Amazon EC2 AMI Locator website.</p>
<p>This is a bit of tedious copy-paste ( 🍝 ) to do and you need to make sure you do it right. Furthermore, what if there’s an update? There will be new IDs and we will need to update them manually again… 🥲</p>
<p>Of course, there’s an easier and more maintainable way! 😋</p>
<h3 id="machine-ami-from-a-public-ssm-parameter" style="position:relative;"><a href="#machine-ami-from-a-public-ssm-parameter" aria-label="machine ami from a public ssm parameter permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Machine AMI from a public SSM parameter</h3>
<p>The better way is to use the function <a href="https://docs.aws.amazon.com/cdk/api/latest/docs/@aws-cdk_aws-ec2.MachineImage.html#static-fromwbrssmparameterparametername-os-userdata"><code>ec2.MachineImage.fromSSMParameter()</code></a>.</p>
<p>As the name suggests, this function allows us to use take the AMI ID from an SSM parameter.
At a first glance, this idea might not sound particularly appealing. In fact, using SSM adds another layer of complexity. We would need to store the wanted AMI ID in SSM first somehow, only to consume the value later from our CDK stack.</p>
<p>The good news is that there are some public SSM parameters that are already pre-populated with the latest ubuntu AMI IDs.</p>
<p>Let’s try to run this in our terminal (you’ll need to have the <a href="https://aws.amazon.com/cli/">AWS CLI</a> installed and configured):</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">aws ssm get-parameter --name <span class="token string">"/aws/service/canonical/ubuntu/server/focal/stable/current/amd64/hvm/ebs-gp2/ami-id"</span></code></pre></div>
<p>The command above will output something like this:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"Parameter"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"Name"</span><span class="token operator">:</span> <span class="token string">"/aws/service/canonical/ubuntu/server/focal/stable/current/amd64/hvm/ebs-gp2/ami-id"</span><span class="token punctuation">,</span>
    <span class="token property">"Type"</span><span class="token operator">:</span> <span class="token string">"String"</span><span class="token punctuation">,</span>
    <span class="token property">"Value"</span><span class="token operator">:</span> <span class="token string">"ami-0298c9e0d2c86b0ed"</span><span class="token punctuation">,</span>
    <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token number">221</span><span class="token punctuation">,</span>
    <span class="token property">"LastModifiedDate"</span><span class="token operator">:</span> <span class="token string">"2021-07-21T14:31:50.717000+01:00"</span><span class="token punctuation">,</span>
    <span class="token property">"ARN"</span><span class="token operator">:</span> <span class="token string">"arn:aws:ssm:eu-west-1::parameter/aws/service/canonical/ubuntu/server/focal/stable/current/amd64/hvm/ebs-gp2/ami-id"</span><span class="token punctuation">,</span>
    <span class="token property">"DataType"</span><span class="token operator">:</span> <span class="token string">"aws:ec2:image"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>As the name of the SSM parameter suggests, these SSM parameters are managed directly by Canonical (the company behind Ubuntu). You can also see that there is a specific path structure to identify the AMI ID. If you are curious to find out more and to discover all the available images you can check out <a href="https://discourse.ubuntu.com/t/finding-ubuntu-images-with-the-aws-ssm-parameter-store/15507">Finding Ubuntu Images with the AWS SSM Parameter Store</a>.</p>
<p>One more thing to notice is that SSM parameters are region-specific. You can have the same parameter key in different regions and therefore have different values in different regions (given the same key).</p>
<p>I am running this command using <code>eu-west-1</code> as the default region and you can see that the <code>Value</code> matches the AMI ID we have manually specified with the AMI map approach. Try to switch your region using the <code>--region</code> flag and you will get the correct AMI ID for the given region.</p>
<p>This is a rather clever usage of SSM if you ask me! 🤩</p>
<p>Enough chit chat, let’s see how to use this approach with CDK:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> machineImage <span class="token operator">=</span> ec2<span class="token punctuation">.</span>MachineImage<span class="token punctuation">.</span><span class="token function">fromSSMParameter</span><span class="token punctuation">(</span>
  <span class="token string">'/aws/service/canonical/ubuntu/server/focal/stable/current/amd64/hvm/ebs-gp2/ami-id'</span><span class="token punctuation">,</span>
  ec2<span class="token punctuation">.</span>OperatingSystemType<span class="token punctuation">.</span><span class="token constant">LINUX</span>
<span class="token punctuation">)</span></code></pre></div>
<p>That’s it! Now we can pass the <code>machineImage</code> value to the settings of our EC2 instance!</p>
<h2 id="a-simple-ec2-instance-with-ubuntu" style="position:relative;"><a href="#a-simple-ec2-instance-with-ubuntu" aria-label="a simple ec2 instance with ubuntu permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A simple EC2 instance with Ubuntu</h2>
<p>Ok, now we have all the building blocks to provision the most basic Ubuntu-based EC2 instance.</p>
<p>This is how the code for our stack (<code>lib/*stack.ts</code>) looks like so far:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> cdk <span class="token keyword">from</span> <span class="token string">'@aws-cdk/core'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ec2 <span class="token keyword">from</span> <span class="token string">'@aws-cdk/aws-ec2'</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CdkUbuntuEc2Stack</span> <span class="token keyword">extends</span> <span class="token class-name">cdk</span><span class="token punctuation">.</span>Stack <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span> <span class="token punctuation">(</span>scope<span class="token operator">:</span> cdk<span class="token punctuation">.</span>Construct<span class="token punctuation">,</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> props<span class="token operator">?</span><span class="token operator">:</span> cdk<span class="token punctuation">.</span>StackProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>scope<span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      env<span class="token operator">:</span> <span class="token punctuation">{</span>
        account<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">CDK_DEPLOY_ACCOUNT</span> <span class="token operator">||</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">CDK_DEFAULT_ACCOUNT</span><span class="token punctuation">,</span>
        region<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">CDK_DEPLOY_REGION</span> <span class="token operator">||</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">CDK_DEFAULT_REGION</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token operator">...</span>props
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> defaultVpc <span class="token operator">=</span> ec2<span class="token punctuation">.</span>Vpc<span class="token punctuation">.</span><span class="token function">fromLookup</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'VPC'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      isDefault<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> machineImage <span class="token operator">=</span> ec2<span class="token punctuation">.</span>MachineImage<span class="token punctuation">.</span><span class="token function">fromSSMParameter</span><span class="token punctuation">(</span>
      <span class="token string">'/aws/service/canonical/ubuntu/server/focal/stable/current/amd64/hvm/ebs-gp2/ami-id'</span><span class="token punctuation">,</span>
      ec2<span class="token punctuation">.</span>OperatingSystemType<span class="token punctuation">.</span><span class="token constant">LINUX</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">const</span> myVm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ec2</span><span class="token punctuation">.</span><span class="token function">Instance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'myVm'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      instanceType<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ec2</span><span class="token punctuation">.</span><span class="token function">InstanceType</span><span class="token punctuation">(</span><span class="token string">'t2.micro'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      machineImage<span class="token operator">:</span> machineImage<span class="token punctuation">,</span>
      vpc<span class="token operator">:</span> defaultVpc
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>If we try to run <code>cdk deploy</code> we should see something like this:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.09375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB90lEQVQoz2WP3U7bQBCF/QAVrYh/93fW9q4dJ4FQSlv1XaCkMaCkhT4xUqvegmJhibvsqRyCetGLT2dmLj7NCS4Xi/t2fdffXN9t1lc/u+v2e/djddutr1fdYnHVnS/a7vxr2y2XN923xWXXLttuvbrtrtpVt1yuuvaFTbtc9RcXy1/BSFGXTGZIjQHLGDKeQkiGJAkRMYaR4hhxBq41uIoRswQxY3gbhjg4DHEw2udhiDfvoqdgdmwfPn+pcPrRbU/OnJ+fGu8a8mVtvK3J12PyVaO9HWuvcuMzoT1T2ktjvNojjdlKMsgEbQIqm8fp0Sc00zNv6zkEVWCqBNcWCTdIeA6hHZgsEWW0uw97mGqMEvWKHzJM1SaIUv3ImxL8pPRRriCchbAWvCoRO0JaGMgjB9YUiHOCGITkEDONKFOIsiG1H3InLKvZ4+TkA8bz9356fAahLKJU777LeI5U5Eg0IRaEJKOdIH6R/CeMdh9m9KBcDe7sNjLkBxIynufOS1d74dxuTk3hI00+YuRjZnyYar+vOrDdV98EQtNGTwzknCBnBqoykNZADTiCtARREERJEJYgDUHlBpIIkjTEHmU0mNRPgS7K37YaP+dF9VS6cV+6urd10xeu6uvJtM9L18eZ6DOu+4yrPpOqZ6+ofzNX6jkV6s9fpp0BVoPIfR4AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/54e9d300121a328d9cf6ed839d45e72a/8d3d1/cdk-deploy-prompt-example.webp 256w,
/static/54e9d300121a328d9cf6ed839d45e72a/354cf/cdk-deploy-prompt-example.webp 512w,
/static/54e9d300121a328d9cf6ed839d45e72a/44907/cdk-deploy-prompt-example.webp 1024w"
              sizes="(max-width: 1024px) 100vw, 1024px"
              type="image/webp"
            />
          <source
            srcset="/static/54e9d300121a328d9cf6ed839d45e72a/85b06/cdk-deploy-prompt-example.png 256w,
/static/54e9d300121a328d9cf6ed839d45e72a/bc282/cdk-deploy-prompt-example.png 512w,
/static/54e9d300121a328d9cf6ed839d45e72a/f1720/cdk-deploy-prompt-example.png 1024w"
            sizes="(max-width: 1024px) 100vw, 1024px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/54e9d300121a328d9cf6ed839d45e72a/f1720/cdk-deploy-prompt-example.png"
            alt="The preview of what will be deployed by running cdk deploy"
            title="The preview of what will be deployed by running cdk deploy"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
    </span></p>
<p>We can now say <code>y</code> to confirm the deployment and sit patiently with our fingers crossed… 🤞</p>
<p>Ok … ⏱ wait over!</p>
<p>If all went well, we should see something like this in the console:</p>
<div class="gatsby-highlight" data-language="plain"><pre class="language-plain"><code class="language-plain"> ✅  CdkUbuntuEc2Stack

Stack ARN:
arn:aws:cloudformation:eu-west-1:012345678901:stack/CdkUbuntuEc2Stack/a0d34481-a364-4261-864b-3cb16f57dc15</code></pre></div>
<p>Our machine is deployed! 🎉</p>
<p>As a small aside, I have to say that <a href="/random-emoji-in-your-prompt-how-and-why">I love the usage of some good emojis in the terminal</a>, well-done AWS!</p>
<p>But let’s be fair, our virtual machine is not very useful… it doesn’t do anything right now!</p>
<p>Let’s try to update our machine and make it do something useful. For instance, we could install nginx and enable ingress on port 80 so that, once the machine is provisioned, we will be able to see the default nginx welcome page.</p>
<p>In a real-life scenario, you might do something a bit more sophisticated to deploy and run a real application on the machine.</p>
<h3 id="adding-a-security-group-to-an-ec2-with-cdk" style="position:relative;"><a href="#adding-a-security-group-to-an-ec2-with-cdk" aria-label="adding a security group to an ec2 with cdk permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding a security group to an EC2 with CDK</h3>
<p>Let’s start by adding a security group to our EC2, this is something we can do by adding the following code to our stack:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> myVmSecurityGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ec2</span><span class="token punctuation">.</span><span class="token function">SecurityGroup</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'myVmSecurityGroup'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  vpc<span class="token operator">:</span> defaultVpc
<span class="token punctuation">}</span><span class="token punctuation">)</span>
myVmSecurityGroup<span class="token punctuation">.</span><span class="token function">addIngressRule</span><span class="token punctuation">(</span>ec2<span class="token punctuation">.</span>Peer<span class="token punctuation">.</span><span class="token function">anyIpv4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ec2<span class="token punctuation">.</span>Port<span class="token punctuation">.</span><span class="token function">tcp</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'httpIpv4'</span><span class="token punctuation">)</span>
myVmSecurityGroup<span class="token punctuation">.</span><span class="token function">addIngressRule</span><span class="token punctuation">(</span>ec2<span class="token punctuation">.</span>Peer<span class="token punctuation">.</span><span class="token function">anyIpv6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ec2<span class="token punctuation">.</span>Port<span class="token punctuation">.</span><span class="token function">tcp</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'httpIpv6'</span><span class="token punctuation">)</span></code></pre></div>
<p>Then we need to associate this new security group to the instance by setting the <code>securityGroup</code> property:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> myVm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ec2</span><span class="token punctuation">.</span><span class="token function">Instance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'myVm'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  securityGroup<span class="token operator">:</span> myVmSecurityGroup<span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Ok, now our virtual machine will be able to accept ingress traffic on port <code>80</code> from all IPv4 and IPv6 addresses.</p>
<h3 id="installing-software-by-using-cloudformation-init-with-cdk" style="position:relative;"><a href="#installing-software-by-using-cloudformation-init-with-cdk" aria-label="installing software by using cloudformation init with cdk permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Installing software by using CloudFormation init with CDK</h3>
<p>CloudFormation supports <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-init.html">a way to execute init scripts once a machine boots</a>.</p>
<p>CDK supports this feature as well and we can use it with the <code>init</code> configuration option in our VM definition:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> myVm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ec2</span><span class="token punctuation">.</span><span class="token function">Instance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'myVm'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  init<span class="token operator">:</span> ec2<span class="token punctuation">.</span>CloudFormationInit<span class="token punctuation">.</span><span class="token function">fromElements</span><span class="token punctuation">(</span>
    ec2<span class="token punctuation">.</span>InitCommand<span class="token punctuation">.</span><span class="token function">shellCommand</span><span class="token punctuation">(</span><span class="token string">'sudo apt-get update -y'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ec2<span class="token punctuation">.</span>InitCommand<span class="token punctuation">.</span><span class="token function">shellCommand</span><span class="token punctuation">(</span><span class="token string">'sudo apt-get install -y nginx'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token comment">// ... more configuration</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<h3 id="cdk-signal-problems-with-ubuntu" style="position:relative;"><a href="#cdk-signal-problems-with-ubuntu" aria-label="cdk signal problems with ubuntu permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDK signal problems with Ubuntu</h3>
<p>At this point we are ready to do another deployment, so let’s run <code>cdk deploy</code>.</p>
<p>This time the deployment should take a long time (10-15mins) and then fail with an error that should look like the following:</p>
<div class="gatsby-highlight" data-language="plain"><pre class="language-plain"><code class="language-plain">CdkUbuntuEc2Stack: deploying...
CdkUbuntuEc2Stack: creating CloudFormation changeset...
17:28:01 | UPDATE_FAILED        | AWS::EC2::Instance        | myVm11CC711A
Failed to receive 1 resource signal(s) within the specified duration</code></pre></div>
<p>It took me a while to figure out what was going wrong and how to solve this problem.</p>
<p>One thing that I eventually did during my investigation was to run <code>cdk synth</code> to see the CloudFormation stack that was being generated and deployed by CDK.</p>
<p>In there I noticed that as part of the <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html">user data script</a>, the following command gets executed: <code>/opt/aws/bin/cfn-signal</code>.</p>
<p>Then, with a bit of timed effort, I managed to establish an SSH connection to an instance while it was being provisioned (and before it was destroyed by CDK) and I realized that the default Ubuntu distribution does not have <code>cfn-signal</code> installed.</p>
<p>This makes sense. This is a specific AWS utility that is pre-installed in Amazon Linux, but there is no reason why it should be installed in Ubuntu or other generic Linux distributions.</p>
<p>So now the problem is “How do we install cfn-signal?”</p>
<p>The answer to this question is “by using a custom user data script”!</p>
<h2 id="installing-aws-linux-utilities-on-an-ubuntu-image-using-cdk" style="position:relative;"><a href="#installing-aws-linux-utilities-on-an-ubuntu-image-using-cdk" aria-label="installing aws linux utilities on an ubuntu image using cdk permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Installing AWS Linux utilities on an Ubuntu Image using CDK</h2>
<p>We can install <code>cfn-signal</code> and other AWS Linux utilities in our virtual machine by creating a custom user data script.</p>
<p>User data scripts run before the init step is executed, so by doing this we should be able to fix our current issue.</p>
<p>After some research and by putting together different resources I managed to get a working script to install the <a href="https://github.com/aws-quickstart/quickstart-linux-utilities">AWS Linux utilities</a> on Ubuntu:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment">#/usr/bin/env bash</span>
<span class="token function">apt-get</span> update -y<span class="token punctuation">;</span>
<span class="token function">apt-get</span> <span class="token function">install</span> -y <span class="token function">git</span> awscli ec2-instance-connect<span class="token punctuation">;</span>
<span class="token keyword">until</span> <span class="token function">git</span> clone https://github.com/aws-quickstart/quickstart-linux-utilities.git<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token string">"Retrying"</span><span class="token punctuation">;</span> <span class="token keyword">done</span><span class="token punctuation">;</span>
<span class="token builtin class-name">cd</span> /quickstart-linux-utilities<span class="token punctuation">;</span>
<span class="token builtin class-name">source</span> quickstart-cfn-tools.source<span class="token punctuation">;</span>
qs_update-os <span class="token operator">||</span> qs_err<span class="token punctuation">;</span>
qs_bootstrap_pip <span class="token operator">||</span> qs_err<span class="token punctuation">;</span>
qs_aws-cfn-bootstrap <span class="token operator">||</span> qs_err<span class="token punctuation">;</span>
<span class="token function">mkdir</span> -p /opt/aws/bin<span class="token punctuation">;</span>
<span class="token function">ln</span> -s /usr/local/bin/cfn-* /opt/aws/bin/<span class="token punctuation">;</span></code></pre></div>
<p>Note that this script also installs the AWS CLI and <code>ec2-instance-connect</code>. These are not strictly necessary for our use case, but they are nice to have.</p>
<p>In CDK, we can create a user data script with these commands as follows:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> userData <span class="token operator">=</span> ec2<span class="token punctuation">.</span>UserData<span class="token punctuation">.</span><span class="token function">forLinux</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
userData<span class="token punctuation">.</span><span class="token function">addCommands</span><span class="token punctuation">(</span>
  <span class="token string">'apt-get update -y'</span><span class="token punctuation">,</span>
  <span class="token string">'apt-get install -y git awscli ec2-instance-connect'</span><span class="token punctuation">,</span>
  <span class="token string">'until git clone https://github.com/aws-quickstart/quickstart-linux-utilities.git; do echo "Retrying"; done'</span><span class="token punctuation">,</span>
  <span class="token string">'cd /quickstart-linux-utilities'</span><span class="token punctuation">,</span>
  <span class="token string">'source quickstart-cfn-tools.source'</span><span class="token punctuation">,</span>
  <span class="token string">'qs_update-os || qs_err'</span><span class="token punctuation">,</span>
  <span class="token string">'qs_bootstrap_pip || qs_err'</span><span class="token punctuation">,</span>
  <span class="token string">'qs_aws-cfn-bootstrap || qs_err'</span><span class="token punctuation">,</span>
  <span class="token string">'mkdir -p /opt/aws/bin'</span><span class="token punctuation">,</span>
  <span class="token string">'ln -s /usr/local/bin/cfn-* /opt/aws/bin/'</span>
<span class="token punctuation">)</span></code></pre></div>
<p>Then, <code>userData</code> needs to be passed to our <code>machineImage</code> as the third argument:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> machineImage <span class="token operator">=</span> ec2<span class="token punctuation">.</span>MachineImage<span class="token punctuation">.</span><span class="token function">fromSSMParameter</span><span class="token punctuation">(</span>
  <span class="token string">'/aws/service/canonical/ubuntu/server/focal/stable/current/amd64/hvm/ebs-gp2/ami-id'</span><span class="token punctuation">,</span>
  ec2<span class="token punctuation">.</span>OperatingSystemType<span class="token punctuation">.</span><span class="token constant">LINUX</span><span class="token punctuation">,</span>
  userData
<span class="token punctuation">)</span></code></pre></div>
<p>With these changes, we should be able to get everything working, but before doing that let’s do one last change: let’s add an output parameter so that, once our stack is deployed, we can see the URL to our web server running nginx.</p>
<h3 id="adding-an-output-value-in-cdk" style="position:relative;"><a href="#adding-an-output-value-in-cdk" aria-label="adding an output value in cdk permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding an output value in CDK</h3>
<p>Adding an output value is quite simple with CDK, we just need to instantiate a new <a href="https://docs.aws.amazon.com/cdk/api/latest/docs/@aws-cdk_core.CfnOutput.html"><code>cdk.CfnOutput</code></a> object:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> webVmUrl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">cdk</span><span class="token punctuation">.</span><span class="token function">CfnOutput</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'webVmUrl'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>myVm<span class="token punctuation">.</span>instancePublicIp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  description<span class="token operator">:</span> <span class="token string">'The URL of our instance'</span><span class="token punctuation">,</span>
  exportName<span class="token operator">:</span> <span class="token string">'webVmUrl'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Now if we run <code>cdk deploy</code>, after a few minutes we should see an output like the following:</p>
<div class="gatsby-highlight" data-language="plain"><pre class="language-plain"><code class="language-plain"> ✅  CdkUbuntuEc2Stack

Outputs:
CdkUbuntuEc2Stack.webVmUrl = http://54.154.84.11/

Stack ARN:
arn:aws:cloudformation:eu-west-1:012345678901:stack/CdkUbuntuEc2Stack/22c0faa4-adb4-4724-a4c4-c8ea21b7ac07</code></pre></div>
<p>If we visit the URL in the output parameter we should see the default nginx welcome page:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 49.21875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABM0lEQVQoz52OYW+CMBRF+f//y0/GqAsbMNB0Aom0tFopUIT2LqA4nSxb9pKTti+9J9eJvNf9OwkLyvgxo0zmXMhClZIyLsPtTm5IKjckkduPdBoynMf3iKgXN4gdrfVZNw3kqQBlOQ5HCS4OKFSJqtbQzXlAVTVUWX1R1Sivu/5fmiSglFaOMabGZWzPcrm08/ncLhYLG4ahXa1WdjabWc65Hf/8AKy1hdN1nb4+hmUcxwiCYCCKogHf95DnDEIICMFA6R5lWeKaG7L92batuglHJyEEnufB9324rjvc1+s3bLY7ZBnFLlHgooIx3YOwv3ddp54ajsKxZZom2FONjDV9AzRnwJhbA9xnJ4XGmBu9YHrsvexJWI/C8dND9BJ44s8NfwtP9v0mrO6X/5kx27bt6RM6wgMdP0MDewAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/af89e3bd8bfcdc02b56a57f54addcc91/8d3d1/welcome-to-nginx-screenshot.webp 256w,
/static/af89e3bd8bfcdc02b56a57f54addcc91/354cf/welcome-to-nginx-screenshot.webp 512w,
/static/af89e3bd8bfcdc02b56a57f54addcc91/44907/welcome-to-nginx-screenshot.webp 1024w"
              sizes="(max-width: 1024px) 100vw, 1024px"
              type="image/webp"
            />
          <source
            srcset="/static/af89e3bd8bfcdc02b56a57f54addcc91/85b06/welcome-to-nginx-screenshot.png 256w,
/static/af89e3bd8bfcdc02b56a57f54addcc91/bc282/welcome-to-nginx-screenshot.png 512w,
/static/af89e3bd8bfcdc02b56a57f54addcc91/f1720/welcome-to-nginx-screenshot.png 1024w"
            sizes="(max-width: 1024px) 100vw, 1024px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/af89e3bd8bfcdc02b56a57f54addcc91/f1720/welcome-to-nginx-screenshot.png"
            alt="nginx default welcome page running on an Ubuntu-based EC2 on AWS"
            title="nginx default welcome page running on an Ubuntu-based EC2 on AWS"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
    </span></p>
<p>It’s working, we made it! 🥳</p>
<p>If you want to see how the full code looks like you can check out the <a href="https://github.com/lmammino/cdk-ubuntu-ec2">“official” repository for this project</a>.</p>
<p>If you want to clean up your account and destroy the stack created by this project, you can run:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">cdk destroy</code></pre></div>
<h2 id="conclusion" style="position:relative;"><a href="#conclusion" aria-label="conclusion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>In this article we learned how to use CDK to provision an Ubuntu-based virtual machine and how to configure it to run the default installation of nginx.</p>
<p>In the process we also learned a bunch of related concepts such as:</p>
<ul>
<li>what is CDK</li>
<li>how to use it to define an EC2 instance</li>
<li>how to reference an AMI</li>
<li>how to add security groups</li>
<li>how to use user data and init script</li>
<li>how to install the AWS Linux Utilities</li>
<li>…and finally how to create a CDK output argument.</li>
</ul>
<p>WOW that was quite a journey, and there I thought this would be a short article! 😅</p>
<p>I hope I didn’t bore you to death and that this article was somewhat useful! <a href="#comments">Let me know what you think in the comments</a> and feel free to <a href="https://twitter.com/loige">connect with me on Twitter</a> for more <a href="/tag/aws">AWS</a> and cloud chats.</p>
<p>If you are interested in working more with AWS and the cloud, you might also want to check out <a href="https://www.fourtheorem.com/">fourTheorem</a>, a group of business focused technologists that <a href="https://www.fourtheorem.com/case-studies">has already helped many companies</a> to get the best out of the cloud (yes, this is where I work 🙃).</p>
<p>See you in the next post!</p>
<p>Bye 👋</p>
<p><small>Thanks to <a href="https://twitter.com/eoins">Eoin Shanaghy</a> for kindly reviewing this article!</small></p></article><style data-emotion="css 1bhol7z">.css-1bhol7z{margin:2em 0;line-height:25px;padding:1em;font-size:small;border-radius:8px;background:rgba(255, 229, 100, 0.3);}.css-1bhol7z a{-webkit-text-decoration:none;text-decoration:none;border-bottom:2px solid #ffe564;color:inherit;}.css-1bhol7z a:hover{border-bottom:2px solid #ff9b51;}@media (min-width: 780px){.css-1bhol7z{padding:2em 2em;}}</style><div class="css-1bhol7z ep8980s0"><strong>Found a typo or something that can be improved?</strong><br/>In the spirit of Open Source, you can contribute to this article by<!-- --> <a href="https://github.com/lmammino/loige.co/blob/master/content/posts/2021-08-06_provision-ubuntu-ec2-with-cdk/index.md" target="_blank" rel="noopener noreferrer">submitting a PR on <svg aria-label="GitHub" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg> GitHub</a></div><div style="border-top:1px solid #ececec;margin-top:2em;padding-top:2em;line-height:1.2" class="css-t2ycg8 ep8980s1"><h2 id="comments"><svg aria-hidden="true" data-prefix="fas" data-icon="comments" class="svg-inline--fa fa-comments fa-w-18" viewBox="0 0 576 512" width="1em" height="1em" style="margin:0 .25em 0 0"><path fill="currentColor" d="M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"></path></svg> Comments</h2><div id="disqus_thread"></div></div></main><style data-emotion="css 1n0r681">.css-1n0r681{-webkit-flex:1;-ms-flex:1;flex:1;background:#f7f7f7;padding:1em;margin:0 0 2em 0;}.css-1n0r681 h3{margin:0 0 0.5em 0;position:relative;color:#111;}@media (min-width: 780px){.css-1n0r681{background:transparent;margin:0 0 1em 0;}.css-1n0r681>div{margin:1em 0 0 0;position:-webkit-sticky;position:sticky;overflow-y:auto;top:70px;}}</style><aside class="css-1n0r681 e1kc7zwr0"><style data-emotion="css 1jztyo0">.css-1jztyo0{background:#ffffcd;padding:0.5em;font-size:12px;display:block;color:inherit;-webkit-text-decoration:none;text-decoration:none;border:1px solid #ffffcd;margin:0 0 1em 0;}.css-1jztyo0:hover{border-color:#f89000;}</style><a href="https://www.nodejsdesignpatterns.com/" class="css-1jztyo0 e1pruv502"><style data-emotion="css jovua5">.css-jovua5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}</style><span class="css-jovua5 e1pruv501"><style data-emotion="css 1mvr8gq">.css-1mvr8gq{width:50%;padding:0 0 0 1em;display:block;}.css-1mvr8gq.left{max-width:125px;padding:0 0 0 1em!important;}@media (max-width: 1024px) and (min-width: 780px){.css-1mvr8gq{width:100%;max-width:auto!important;margin:0;}.css-1mvr8gq.left{padding:0 0 0 1em;}.css-1mvr8gq h4{padding:1em 0 0.5em 0!important;}}.css-1mvr8gq:first-of-type{padding:0;}.css-1mvr8gq h4{padding:0 0 0.5em 0;font-size:14px;}</style><span class="left css-1mvr8gq e1pruv500"><img src="/static/200-1cf8c01eb1b97df13cb6f6f3f36de3c0.jpg" style="width:100%" alt="Node.js Design Patterns Third Edition"/></span><span class="css-1mvr8gq e1pruv500"><h4>Node.js Design Patterns</h4><p>Design and implement production-grade <strong>Node.js</strong> <!-- -->applications using proven patterns and techniques with<!-- --> <em>Node.js Design Patterns Third Edition</em>. Available as<!-- --> <strong>Digital</strong> and <strong>Print</strong>.</p></span></span></a><div><style data-emotion="css exth3p">.css-exth3p ol{color:#6d6d6d;padding:0 0 0 2em;list-style:decimal-leading-zero;}.css-exth3p ol ol{padding:0 0 0 0.3em;}.css-exth3p ol li{font-size:0.8rem;font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace;margin-top:5px;color:#111;}.css-exth3p ol li a{font-size:1.2em;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;color:#6d6d6d;border-bottom:1px solid transparent;-webkit-text-decoration:none;text-decoration:none;font-weight:bold;}.css-exth3p ol li a:hover{color:#000;outline-width:0;}.css-exth3p ol li.depth-3{font-size:0.8em;list-style:none;}</style><div class="css-exth3p eu4hp7r0"><h3>Sections</h3><ol><li class="depth-2"><a href="#what-is-cdk">What is CDK</a></li><li class="depth-2"><a href="#defining-an-ec2-resource-with-cdk">Defining An EC2 resource with CDK</a></li><li class="depth-2"><a href="#ubuntu-amis-and-where-to-find-them">Ubuntu AMIs and where to find them</a><ol><li class="depth-3"><a href="#machine-ami-map">Machine AMI map</a></li><li class="depth-3"><a href="#machine-ami-from-a-public-ssm-parameter">Machine AMI from a public SSM parameter</a></li></ol></li><li class="depth-2"><a href="#a-simple-ec2-instance-with-ubuntu">A simple EC2 instance with Ubuntu</a><ol><li class="depth-3"><a href="#adding-a-security-group-to-an-ec2-with-cdk">Adding a security group to an EC2 with CDK</a></li><li class="depth-3"><a href="#installing-software-by-using-cloudformation-init-with-cdk">Installing software by using CloudFormation init with CDK</a></li><li class="depth-3"><a href="#cdk-signal-problems-with-ubuntu">CDK signal problems with Ubuntu</a></li></ol></li><li class="depth-2"><a href="#installing-aws-linux-utilities-on-an-ubuntu-image-using-cdk">Installing AWS Linux utilities on an Ubuntu Image using CDK</a><ol><li class="depth-3"><a href="#adding-an-output-value-in-cdk">Adding an output value in CDK</a></li></ol></li><li class="depth-2"><a href="#conclusion">Conclusion</a></li></ol></div><h3 style="margin-top:1em">Share</h3><style data-emotion="css 125xt49">.css-125xt49{list-style:none;font-size:30px;padding:0.2em 0;}.css-125xt49 li{display:inline-block;margin:0 0.2em 0 0;}.css-125xt49 li a{color:#6d6d6d;}.css-125xt49 li a.twitter:hover{color:#00aced;}.css-125xt49 li a.facebook:hover{color:#3b5998;}.css-125xt49 li a.linkedin:hover{color:#007bb6;}.css-125xt49 li a.pinterest:hover{color:#cb2027;}.css-125xt49 li a.email:hover{color:black;}</style><ul class="css-125xt49 ey4v4xz0"><li><a rel="nofollow noopener noreferrer" class="twitter" target="_blank" href="https://twitter.com/intent/tweet?text=Provision%20an%20Ubuntu-based%20EC2%20instance%20with%20CDK&amp;url=https%3A%2F%2Floige.co%2Fprovision-ubuntu-ec2-with-cdk%2F&amp;source=https%3A%2F%2Floige.co&amp;related=loige&amp;via=loige" title="Share via twitter"><svg aria-label="Twitter" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M23.954 4.569a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.691 8.094 4.066 6.13 1.64 3.161a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.061a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.937 4.937 0 0 0 4.604 3.417 9.868 9.868 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63a9.936 9.936 0 0 0 2.46-2.548l-.047-.02z"></path></svg></a></li><li><a rel="nofollow noopener noreferrer" class="facebook" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Floige.co%2Fprovision-ubuntu-ec2-with-cdk%2F" title="Share via facebook"><svg aria-hidden="true" data-prefix="fab" data-icon="facebook-square" class="svg-inline--fa fa-facebook-square fa-w-14" viewBox="0 0 448 512" width="1em" height="1em"><path fill="currentColor" d="M448 80v352c0 26.5-21.5 48-48 48h-85.3V302.8h60.6l8.7-67.6h-69.3V192c0-19.6 5.4-32.9 33.5-32.9H384V98.7c-6.2-.8-27.4-2.7-52.2-2.7-51.6 0-87 31.5-87 89.4v49.9H184v67.6h60.9V480H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48z"></path></svg></a></li><li><a rel="nofollow noopener noreferrer" class="linkedin" target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Floige.co%2Fprovision-ubuntu-ec2-with-cdk%2F&amp;title=Provision%20an%20Ubuntu-based%20EC2%20instance%20with%20CDK&amp;source=https%3A%2F%2Floige.co" title="Share via linkedin"><svg aria-hidden="true" data-prefix="fab" data-icon="linkedin-in" class="svg-inline--fa fa-linkedin-in fa-w-14" viewBox="0 0 448 512" width="1em" height="1em"><path fill="currentColor" d="M100.3 480H7.4V180.9h92.9V480zM53.8 140.1C24.1 140.1 0 115.5 0 85.8 0 56.1 24.1 32 53.8 32c29.7 0 53.8 24.1 53.8 53.8 0 29.7-24.1 54.3-53.8 54.3zM448 480h-92.7V334.4c0-34.7-.7-79.2-48.3-79.2-48.3 0-55.7 37.7-55.7 76.7V480h-92.8V180.9h89.1v40.8h1.3c12.4-23.5 42.7-48.3 87.9-48.3 94 0 111.3 61.9 111.3 142.3V480z"></path></svg></a></li><li><a rel="nofollow noopener noreferrer" class="pinterest" target="_blank" href="https://pinterest.com/pin/create/button/?media=https%3A%2F%2Floige.co%2Fstatic%2F9e5e2056046a128d577fe018946df76b%2Fprovision-ubuntu-ec2-with-cdk-luciano-mammino-loige.jpg&amp;url=https%3A%2F%2Floige.co%2Fprovision-ubuntu-ec2-with-cdk%2F&amp;is_video=false&amp;description=Provision%20an%20Ubuntu-based%20EC2%20instance%20with%20CDK" title="Share via pinterest"><svg aria-hidden="true" data-prefix="fab" data-icon="pinterest" class="svg-inline--fa fa-pinterest fa-w-16" viewBox="0 0 496 512" width="1em" height="1em"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6 0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8 0 128.7-68.8 128.7-154.3 0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1 0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6 0-54.7 41.4-107.6 112-107.6 60.9 0 103.6 41.5 103.6 100.9 0 67.1-33.9 113.6-78 113.6-24.3 0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6 0-19-10.2-34.9-31.4-34.9-24.9 0-44.9 25.7-44.9 60.2 0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9 0 361.1 0 256 0 119 111 8 248 8s248 111 248 248z"></path></svg></a></li><li><a rel="nofollow noopener noreferrer" class="email" target="_blank" href="/cdn-cgi/l/email-protection#85baa3e4e8f5bee7eae1fcb8a0b5c4d5f7eaf3ecf6eceaeba0b7b5e4eba0b7b5d0e7f0ebf1f0a8e7e4f6e0e1a0b7b5c0c6b7a0b7b5ecebf6f1e4ebe6e0a0b7b5f2ecf1eda0b7b5c6c1cea0b5c4a0b5c4edf1f1f5f6a0b6c4a0b7c3a0b7c3e9eaece2e0abe6eaa0b7c3f5f7eaf3ecf6eceaeba8f0e7f0ebf1f0a8e0e6b7a8f2ecf1eda8e6e1eea0b7c3a3e4e8f5bef6f0e7efe0e6f1b8d5f7eaf3ecf6eceaeba0b7b5e4eba0b7b5d0e7f0ebf1f0a8e7e4f6e0e1a0b7b5c0c6b7a0b7b5ecebf6f1e4ebe6e0a0b7b5f2ecf1eda0b7b5c6c1ce" title="Share via email"><svg aria-hidden="true" data-prefix="far" data-icon="envelope" class="svg-inline--fa fa-envelope fa-w-16" viewBox="0 0 512 512" width="1em" height="1em"><path fill="currentColor" d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"></path></svg></a></li></ul><h3 style="margin-top:1em">Similar posts</h3><style data-emotion="css 11m37pp">.css-11m37pp{color:#6d6d6d;list-style:outside;padding:0 0 0 1.25em;}.css-11m37pp li{margin:0.75em 0 0 0;}.css-11m37pp li:first-of-type{margin-top:0;}.css-11m37pp a{color:#6d6d6d;-webkit-text-decoration:none;text-decoration:none;font-weight:bold;}.css-11m37pp a:hover{color:#000;}</style><ul class="css-11m37pp e1empo690"><li><a href="/versioning-and-deploying-a-static-website-with-git-flightplan-and-nginx">Versioning and deploying a static website with Git, Flightplan and Nginx</a></li><li><a href="/how-to-send-gzipped-requests-with-boto3">How to send gzipped requests with boto3</a></li><li><a href="/middy-1-is-here">Middy 1.0.0 is here</a></li><li><a href="/lean-npm-packages">Lean NPM packages</a></li><li><a href="/fastify-and-preact-for-quick-web-app-prototyping">Fastify and Preact for quick web app prototyping</a></li></ul></div></aside></div></section></div><style data-emotion="css 1ywtb7p">.css-1ywtb7p{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;list-style:none;padding:0;font-size:14px;min-height:260px;}@media (min-width: 780px){.css-1ywtb7p{-webkit-box-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;font-size:16px;}}@media (min-width: 1024px){.css-1ywtb7p{height:300px;font-size:18px;}}</style><ul class="css-1ywtb7p e191jpam2"><style data-emotion="css 92w3s3">.css-92w3s3{width:100%;text-align:center;min-height:100%;background:black;-webkit-background-size:cover;background-size:cover;}.css-92w3s3 a{-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;background:rgba(0, 0, 0, 0.8);height:100%;-webkit-transition:background 0.5s ease;transition:background 0.5s ease;padding:1em;}.css-92w3s3 a:hover{background:rgba(0, 0, 0, 0.3);}.css-92w3s3 a h4{color:#fff;font-size:1.2em;}.css-92w3s3 a p{color:rgba(255, 255, 255, 0.8);font-size:0.8em;vertical-align:middle;line-height:1em;}.css-92w3s3 a p svg{vertical-align:text-bottom;}</style><li style="background-image:url(/static/8b41b98bf31055ba99f44b3531680e24/how-to-send-gzipped-requests-with-boto3-luciano-mammino-loige.jpg)" class="css-92w3s3 e191jpam1"><a rel="prev" href="/how-to-send-gzipped-requests-with-boto3"><style data-emotion="css 16g7a2l">.css-16g7a2l{display:inline-block;padding:4px 10px 5px;text-transform:uppercase;font-size:0.8em;color:rgba(255, 255, 255, 0.8);}</style><span class="css-16g7a2l e191jpam0">Read this next</span><h4>How to send gzipped requests with boto3</h4><p><svg aria-hidden="true" data-prefix="far" data-icon="eye" class="svg-inline--fa fa-eye fa-w-18" viewBox="0 0 576 512" width="1em" height="1em"><path fill="currentColor" d="M569.354 231.631C512.97 135.949 407.81 72 288 72 168.14 72 63.004 135.994 6.646 231.631a47.999 47.999 0 0 0 0 48.739C63.031 376.051 168.19 440 288 440c119.86 0 224.996-63.994 281.354-159.631a47.997 47.997 0 0 0 0-48.738zM288 392c-102.556 0-192.091-54.701-240-136 44.157-74.933 123.677-127.27 216.162-135.007C273.958 131.078 280 144.83 280 160c0 30.928-25.072 56-56 56s-56-25.072-56-56l.001-.042C157.794 179.043 152 200.844 152 224c0 75.111 60.889 136 136 136s136-60.889 136-136c0-31.031-10.4-59.629-27.895-82.515C451.704 164.638 498.009 205.106 528 256c-47.908 81.299-137.444 136-240 136z"></path></svg> <!-- -->13<!-- --> minutes read</p></a></li></ul><style data-emotion="css 98dwl5">.css-98dwl5{background-color:#20232a;color:#ffffff;padding-top:30px;padding-bottom:50px;position:relative;}</style><footer class="css-98dwl5 ecf9mth10"><style data-emotion="css rxhh6g">.css-rxhh6g{position:absolute;width:100%;top:0;height:2px;display:block;transform-origin:left center 0px;-webkit-transform:scaleX(1);-moz-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);z-index:50;-webkit-transition:-webkit-transform 400ms ease 100ms;transition:transform 400ms ease 100ms;background:linear-gradient(90deg, #46c9e5, #d26ac2);}</style><span class="css-rxhh6g ecf9mth9"></span><style data-emotion="css 1tjci2f">.css-1tjci2f{padding-left:20px;padding-right:20px;max-width:1260px;margin-left:auto;margin-right:auto;}@media (min-width: 780px){.css-1tjci2f{width:90%;}}</style><div class="css-1tjci2f ecf9mth8"><style data-emotion="css y6mpu4">.css-y6mpu4{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}</style><div class="css-y6mpu4 ecf9mth7"><style data-emotion="css 17fog7c">.css-17fog7c{-webkit-flex:1 auto;-ms-flex:1 auto;flex:1 auto;margin-bottom:1em;padding-right:1em;width:100%;}@media (min-width: 780px){.css-17fog7c{width:auto;}}</style><div class="css-17fog7c ecf9mth5"><style data-emotion="css mhff0s">.css-mhff0s{color:#d26ac2;font-size:14px;font-weight:bold;line-height:3;text-transform:uppercase;letter-spacing:0.08em;}</style><div style="color:#46c9e5" class="css-mhff0s ecf9mth3">Loige.co</div><style data-emotion="css 15vbtor">.css-15vbtor{font-size:0.8em;padding:4px 0 0 0;color:#ccc;}.css-15vbtor a{color:inherit;font-weight:bold;-webkit-text-decoration:none;text-decoration:none;}.css-15vbtor a:hover{color:#46c9e5;-webkit-text-decoration:underline;text-decoration:underline;}</style><p class="css-15vbtor ecf9mth1">Copyright © Luciano Mammino 2014-<!-- -->2021<!-- -->.</p><p class="css-15vbtor ecf9mth1">Built with<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="https://www.gatsbyjs.org">Gatsby</a>, Coffee and a lot of <style data-emotion="css 12awzcx">.css-12awzcx{color:#d26ac2;}.css-12awzcx:hover{color:red;}</style><span class="css-12awzcx ecf9mth0">❤︎</span>.</p><p class="css-15vbtor ecf9mth1">Loige logo designed by<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="http://andreamangano.com">Andrea Mangano</a>.</p><p class="css-15vbtor ecf9mth1">Hosted on<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="https://github.com/lmammino/loige.co">GitHub</a>, accelerated by<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="https://www.cloudflare.com">Cloudflare</a>.</p><p class="css-15vbtor ecf9mth1">Theme inspired by<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="https://reactjs.org/docs/">React documentation.</a></p><p class="css-15vbtor ecf9mth1">Icons by<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="https://fontawesome.com/">Font Awesome</a>.</p></div><style data-emotion="css fhit9x">.css-fhit9x{-webkit-flex:1 auto;-ms-flex:1 auto;flex:1 auto;margin-bottom:1em;padding-right:1em;}</style><div class="css-fhit9x ecf9mth6"><style data-emotion="css dnp3pp">.css-dnp3pp{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><div class="css-dnp3pp ecf9mth4"><div class="css-mhff0s ecf9mth3">Explore</div><style data-emotion="css 1ez8siy">.css-1ez8siy{color:inherit;line-height:2;-webkit-text-decoration:none;text-decoration:none;}.css-1ez8siy:hover{color:#46c9e5;}</style><a href="/" class="css-1ez8siy ecf9mth2">Blog</a><a href="/speaking" class="css-1ez8siy ecf9mth2">Speaking</a><a href="/about" class="css-1ez8siy ecf9mth2">About</a><a href="/comment-policy" class="css-1ez8siy ecf9mth2">Comment Policy</a></div></div><div class="css-fhit9x ecf9mth6"><div class="css-dnp3pp ecf9mth4"><div class="css-mhff0s ecf9mth3">My Projects</div><a target="_blank" rel="nofollow noopener noreferrer" href="https://www.nodejsdesignpatterns.com" class="css-1ez8siy ecf9mth2">Node.js Design Patterns</a><a target="_blank" rel="nofollow noopener noreferrer" href="https://serverlesslab.com" class="css-1ez8siy ecf9mth2">ServerlessLab</a><a target="_blank" rel="nofollow noopener noreferrer" href="https://fullstackbulletin.com" class="css-1ez8siy ecf9mth2">FullStack Bulletin</a><a target="_blank" rel="nofollow noopener noreferrer" href="https://middy.js.org" class="css-1ez8siy ecf9mth2">Middy</a></div></div><div class="css-fhit9x ecf9mth6"><div class="css-dnp3pp ecf9mth4"><div class="css-mhff0s ecf9mth3">Follow me</div><a rel="nofollow noopener noreferrer" href="https://twitter.com/loige" class="css-1ez8siy ecf9mth2"><svg aria-label="Twitter" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M23.954 4.569a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.691 8.094 4.066 6.13 1.64 3.161a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.061a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.937 4.937 0 0 0 4.604 3.417 9.868 9.868 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63a9.936 9.936 0 0 0 2.46-2.548l-.047-.02z"></path></svg> Twitter</a><a rel="nofollow noopener noreferrer" href="https://twitch.tv/loige" class="css-1ez8siy ecf9mth2"><svg aria-label="Twitch" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M.975 4.175v16.694h5.749V24h3.139l3.134-3.132h4.705l6.274-6.258V0H2.542zm3.658-2.09h17.252v11.479l-3.66 3.652h-5.751L9.34 20.343v-3.127H4.633z"></path><path fill="currentColor" d="M10.385 6.262h2.09v6.26h-2.09zM16.133 6.262h2.091v6.26h-2.091z"></path></svg> Twitch</a><a rel="nofollow noopener noreferrer" href="https://www.youtube.com/channel/UCL0w2IAjTBx3NNka-l7InPw" class="css-1ez8siy ecf9mth2"><svg aria-label="Youtube" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M23.469 5.929l.03.196a3.043 3.043 0 0 0-2.068-2.112l-.021-.005c-1.871-.508-9.4-.508-9.4-.508s-7.51-.01-9.4.508A3.044 3.044 0 0 0 .527 6.104l-.005.021c-.699 3.651-.704 8.038.031 11.947l-.031-.198a3.043 3.043 0 0 0 2.068 2.112l.021.005c1.869.509 9.4.509 9.4.509s7.509 0 9.4-.509a3.043 3.043 0 0 0 2.084-2.096l.005-.021c.318-1.698.5-3.652.5-5.648l-.001-.221.001-.23c0-1.997-.182-3.951-.531-5.846zM9.608 15.651V8.358l6.266 3.652z"></path></svg> Youtube</a><a rel="nofollow noopener noreferrer" href="https://www.linkedin.com/in/lucianomammino" class="css-1ez8siy ecf9mth2"><svg aria-label="LinkedIn" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg> Linkedin</a><a rel="nofollow noopener noreferrer" href="https://github.com/lmammino" class="css-1ez8siy ecf9mth2"><svg aria-label="GitHub" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg> GitHub</a></div></div></div></div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-47248506-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/provision-ubuntu-ec2-with-cdk/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-e4ec0435b44fba9b8b39.js"],"app":["/app-514e309b4e51a67a0ada.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-4c9ab4251958cf3dbd2c.js"],"component---content-pages-about-js":["/component---content-pages-about-js-4633ff8e8e6a282a19b1.js"],"component---content-pages-comment-policy-js":["/component---content-pages-comment-policy-js-3c6a39721512017d8ec9.js"],"component---src-pages-404-js":["/component---src-pages-404-js-dc2b10ea69db3388f05e.js"],"component---src-templates-blog-index-js":["/component---src-templates-blog-index-js-53d33cfd3e02466e4117.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-f8a40d902eea460a8b7d.js"],"component---src-templates-blog-post-share-image-js":["/component---src-templates-blog-post-share-image-js-05c00175dfd3cda6599c.js"],"component---src-templates-speaking-index-js":["/component---src-templates-speaking-index-js-fd364170d3dbe5d3a93d.js"],"component---src-templates-tag-index-js":["/component---src-templates-tag-index-js-3552ab9114277143e61a.js"]};/*]]>*/</script><script src="/polyfill-e4ec0435b44fba9b8b39.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-f8a40d902eea460a8b7d.js" async=""></script><script src="/4d6423837748823c19bdd3076c1db680baba727b-30a9131768be883bb7a1.js" async=""></script><script src="/850935577dc6138b95e5bc3f6f1d9b06bd36398e-bd6be05cfb6becde2e63.js" async=""></script><script src="/ab670281d767243777119348a2b810446e7309bb-19b089964506eaf24367.js" async=""></script><script src="/app-514e309b4e51a67a0ada.js" async=""></script><script src="/framework-9d9eff57288a5d76d992.js" async=""></script><script src="/webpack-runtime-0019acd3e3ba19e6ba77.js" async=""></script></body></html>